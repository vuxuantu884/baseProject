{"ast":null,"code":"import { __awaiter as t, __generator as e } from \"tslib\";\nimport { CREATE_SUBWINDOW_FAILED as i, EXCEPTION_IN_SUBWINDOW as r, UNAUTHORIZED as o, INVALID_ARGUMENT as n, MAX_NUM_OF_SEND_MESSAGES as s, INVALID_CONFIG as a, FORBIDDEN as l } from \"@liff/consts\";\nimport { qs as h, getOriginOfUrl as u, isIpad as c, createLiffError as f, LiffError as p, compareVersion as d } from \"@liff/util\";\nimport { getConfig as w, getContext as g } from \"@liff/store\";\nimport { isInClient as m } from \"@liff/is-in-client\";\nimport { isLoggedIn as b } from \"@liff/is-logged-in\";\nimport { sendShareTargetPicker as v } from \"@liff/analytics\";\nimport { isSubWindow as y } from \"@liff/is-sub-window\";\nimport { getLineVersion as T } from \"@liff/get-line-version\";\nimport { logger as k } from \"@liff/logger\";\nimport { getEndPoint as P, fetch as C } from \"@liff/server-api\";\nimport { getOS as S } from \"@liff/get-os\";\nimport { messageReceive as I, messageTell as W, removeListen as A } from \"@liff/window-postmessage\";\n\nvar E = function () {\n  function r() {\n    this.payloadToShareTargetPicker = null, this.popupWindow = null, this.doesWaitForSubwindowResult = !1;\n  }\n\n  return r.getInstance = function () {\n    return r.instance ? r.instance.reset() : r.instance = new r(), r.instance;\n  }, r.prototype.init = function (i) {\n    return t(this, void 0, void 0, function () {\n      var t, r;\n      return e(this, function (e) {\n        switch (e.label) {\n          case 0:\n            return e.trys.push([0, 5,, 6]), this.liffId = i.referrer.liffId, this.doesWaitForSubwindowResult = !(!i.options || !i.options.waitForSubwindowResult), this.allowPostMessageOrigin = this.initAllowPostMessageOrigin(), this.payloadToShareTargetPicker = this.buildPayloadToShareTargetPicker(i), window.AbortController && (this.abortController = new window.AbortController()), this.prepareAnotherWindow(), [4, this.initOtt()];\n\n          case 1:\n            return e.sent(), this.initListener(), this.openAnotherWindow(), this.doesWaitForSubwindowResult ? [4, this.pollingShareResult()] : [3, 3];\n\n          case 2:\n            return t = e.sent(), this.finalize(), [2, t];\n\n          case 3:\n            return [2];\n\n          case 4:\n            return [3, 6];\n\n          case 5:\n            if (r = e.sent(), this.finalize(), \"AbortError\" !== r.name) throw r;\n            return [3, 6];\n\n          case 6:\n            return [2];\n        }\n      });\n    });\n  }, r.prototype.resetAllVariables = function () {\n    this.liffId = \"\", this.allowPostMessageOrigin = \"\", this.payloadToShareTargetPicker = null, this.ott = \"\", this.popupWindow = null, this.timeoutIDForHealthCheck = null, this.abortController = null, this.internalError = null, this.doesWaitForSubwindowResult = !1;\n  }, r.prototype.reset = function () {\n    this.finalize(), this.resetAllVariables();\n  }, r.prototype.finalize = function () {\n    var t, e;\n    this.abortController && this.abortController.abort(), m() || (t = this.timeoutIDForHealthCheck, e = this.popupWindow, A(window, \"message.receivedHealthcheck\"), t && clearTimeout(t), e && !e.closed && e.close());\n  }, r.prototype.buildPayloadToShareTargetPicker = function (t) {\n    return {\n      messages: t.messages,\n      isMultiple: t.isMultiple,\n      referrer: t.referrer\n    };\n  }, r.prototype.initAllowPostMessageOrigin = function (t) {\n    return void 0 === t && (t = P(\"shareTargetPicker\")), u(t);\n  }, r.prototype.initOtt = function () {\n    return t(this, void 0, void 0, function () {\n      var t, i, r;\n      return e(this, function (e) {\n        switch (e.label) {\n          case 0:\n            return this.abortController && (t = this.abortController.signal), i = P(\"shareTargetPickerOtt\") + \"/\" + this.liffId + \"/ott\", r = this, [4, C(i, {\n              method: \"GET\",\n              signal: t\n            }).then(function (t) {\n              return t.ott;\n            })];\n\n          case 1:\n            return r.ott = e.sent(), [2];\n        }\n      });\n    });\n  }, r.prototype.prepareAnotherWindow = function () {\n    m() || (\"ios\" !== S() || c() ? this.popupWindow = window.open(\"\", \"liffpopup\", \"width=480, height=640, menubar=no, toolbar=no, scrollbars=yes\") : this.popupWindow = window.open());\n  }, r.prototype.openAnotherWindow = function () {\n    if (m() && this.payloadToShareTargetPicker) t = this.liffId, e = this.ott, r = this.payloadToShareTargetPicker, o = {\n      liffId: t,\n      ott: e,\n      data: JSON.stringify(r),\n      closeModals: !1\n    }, location.href = \"line://picker?\" + h.stringify(o);else {\n      if (this.timeoutIDForHealthCheck = window.setTimeout(this.healthCheck.bind(this), 1e3), !this.popupWindow) throw f(i);\n      !function (t, e, i) {\n        var r = {\n          liffId: e,\n          ott: i\n        };\n        t.location.href = P(\"shareTargetPicker\") + \"?\" + h.stringify(r);\n      }(this.popupWindow, this.liffId, this.ott);\n    }\n    var t, e, r, o;\n  }, r.prototype.initListener = function () {\n    var t, e;\n    m() || (t = this.onReceivedHealthcheck.bind(this), e = this.allowPostMessageOrigin, I(window, \"receivedHealthcheck\", t, e));\n  }, r.prototype.healthCheck = function () {\n    return t(this, void 0, void 0, function () {\n      var t;\n      return e(this, function (e) {\n        switch (e.label) {\n          case 0:\n            if (this.popupWindow && !this.popupWindow.closed) return [3, 7];\n            if (!this.doesWaitForSubwindowResult) return [3, 5];\n            e.label = 1;\n\n          case 1:\n            return e.trys.push([1, 3,, 4]), [4, this.onCanceled()];\n\n          case 2:\n            return e.sent(), [3, 4];\n\n          case 3:\n            return t = e.sent(), this.internalError = t, [3, 4];\n\n          case 4:\n            return [3, 6];\n\n          case 5:\n            this.finalize(), e.label = 6;\n\n          case 6:\n            return [3, 8];\n\n          case 7:\n            i = this.popupWindow, r = this.allowPostMessageOrigin, W(i, \"healthcheck\", void 0, r), this.timeoutIDForHealthCheck = window.setTimeout(this.healthCheck.bind(this), 1e3), e.label = 8;\n\n          case 8:\n            return [2];\n        }\n\n        var i, r;\n      });\n    });\n  }, r.prototype.onReceivedHealthcheck = function () {\n    if (!this.popupWindow || !this.payloadToShareTargetPicker) throw f(i);\n    var t, e, r;\n    t = this.popupWindow, e = this.payloadToShareTargetPicker, r = this.allowPostMessageOrigin, W(t, \"ready\", e, r);\n  }, r.prototype.onCanceled = function () {\n    return t(this, void 0, void 0, function () {\n      var t, i;\n      return e(this, function (e) {\n        switch (e.label) {\n          case 0:\n            if (m() || !this.ott) throw new Error(\"need to call with ott in client\");\n            return this.abortController && (t = this.abortController.signal), i = {\n              liffId: this.liffId,\n              ott: this.ott\n            }, [4, C(P(\"shareTargetPickerResult\") + \"?\" + h.stringify(i), {\n              method: \"POST\",\n              signal: t,\n              headers: {\n                Accept: \"application/json\",\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\n              },\n              body: \"result=CANCEL\"\n            })];\n\n          case 1:\n            return [2, \"ok\" === e.sent().status];\n        }\n      });\n    });\n  }, r.prototype.getShareResult = function () {\n    return t(this, void 0, void 0, function () {\n      var t, i;\n      return e(this, function (e) {\n        if (!this.ott) throw new Error(\"need to call with ott in client\");\n        return this.abortController && (t = this.abortController.signal), i = {\n          liffId: this.liffId,\n          ott: this.ott\n        }, k.debug(\"fetch: getShareResult\"), [2, C(P(\"shareTargetPickerResult\") + \"?\" + h.stringify(i), {\n          method: \"GET\",\n          headers: {\n            Accept: \"application/json\"\n          },\n          signal: t\n        })];\n      });\n    });\n  }, r.isPollingTimeOut = function (t, e) {\n    return (e - t) / 6e4 >= 10;\n  }, r.prototype.pollingShareResult = function () {\n    return t(this, void 0, void 0, function () {\n      var t, i;\n      return e(this, function (e) {\n        switch (e.label) {\n          case 0:\n            t = Date.now(), e.label = 1;\n\n          case 1:\n            if (r.isPollingTimeOut(t, Date.now())) return [3, 4];\n            if (this.internalError) throw this.internalError;\n            return [4, this.getShareResult()];\n\n          case 2:\n            if ((i = e.sent()) && i.result) switch (i.result) {\n              case \"SUCCESS\":\n                return [2, {\n                  status: \"success\"\n                }];\n\n              case \"CANCEL\":\n                return [2];\n\n              case \"FAILURE\":\n              default:\n                throw new Error(i.resultDescription);\n            }\n            return [4, new Promise(function (t) {\n              setTimeout(t, 500);\n            })];\n\n          case 3:\n            return e.sent(), [3, 1];\n\n          case 4:\n            throw new Error(\"Timeout: not finished within 10min\");\n        }\n      });\n    });\n  }, r;\n}(),\n    R = function () {\n  function i() {\n    var i = this;\n    this.name = \"shareTargetPicker\", this.shareTargetPicker = function (l, h) {\n      return void 0 === h && (h = {}), t(i, void 0, void 0, function () {\n        var t, i, u, c, g, y, k;\n        return e(this, function (e) {\n          switch (e.label) {\n            case 0:\n              if (t = void 0 === h.isMultiple || h.isMultiple, this.checkPermission(), !b()) throw f(o, \"Need access_token for api call, Please login first\");\n              if (!l || !Array.isArray(l) || 0 === l.length) throw f(n, \"no proper argument\");\n              if (l.length > s) throw f(n, \"exceed the limit of num of messages\");\n              if (!(i = w().liffId)) throw f(a);\n              window.liff && (u = window.liff).analytics && v(u.analytics), e.label = 1;\n\n            case 1:\n              return e.trys.push([1, 3,, 4]), c = E.getInstance(), g = T(), y = {\n                waitForSubwindowResult: !0\n              }, m() && g && d(g, \"10.11.0\") < 0 && (y.waitForSubwindowResult = !1), [4, c.init({\n                messages: l,\n                isMultiple: t,\n                referrer: {\n                  liffId: i,\n                  url: location.origin\n                },\n                options: y\n              })];\n\n            case 2:\n              return [2, e.sent()];\n\n            case 3:\n              throw (k = e.sent()) instanceof p ? k : f(r, k.message);\n\n            case 4:\n              return [2];\n          }\n        });\n      });\n    }, this.checkPermission = function () {\n      if (y()) throw f(l, \"The operation is not allowed in the SubWindow\");\n      var t = ((g() || {}).availability || {}).shareTargetPicker || {},\n          e = t.permission,\n          i = t.minVer;\n      if (!e) throw m() ? f(l, \"Need LINE App \" + i + \" at least or consent on shareTargetPicker usage on LINE developer site\") : f(l, \"Need consent on shareTargetPicker usage on LINE developer site\");\n    };\n  }\n\n  return i.prototype.install = function () {\n    return this.shareTargetPicker;\n  }, i;\n}(),\n    O = new R();\n\nexport { R as ShareTargetPickerModule, O as module };","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/@liff/share-target-picker/lib/index.es.js"],"names":["__awaiter","t","__generator","e","CREATE_SUBWINDOW_FAILED","i","EXCEPTION_IN_SUBWINDOW","r","UNAUTHORIZED","o","INVALID_ARGUMENT","n","MAX_NUM_OF_SEND_MESSAGES","s","INVALID_CONFIG","a","FORBIDDEN","l","qs","h","getOriginOfUrl","u","isIpad","c","createLiffError","f","LiffError","p","compareVersion","d","getConfig","w","getContext","g","isInClient","m","isLoggedIn","b","sendShareTargetPicker","v","isSubWindow","y","getLineVersion","T","logger","k","getEndPoint","P","fetch","C","getOS","S","messageReceive","I","messageTell","W","removeListen","A","E","payloadToShareTargetPicker","popupWindow","doesWaitForSubwindowResult","getInstance","instance","reset","prototype","init","label","trys","push","liffId","referrer","options","waitForSubwindowResult","allowPostMessageOrigin","initAllowPostMessageOrigin","buildPayloadToShareTargetPicker","window","AbortController","abortController","prepareAnotherWindow","initOtt","sent","initListener","openAnotherWindow","pollingShareResult","finalize","name","resetAllVariables","ott","timeoutIDForHealthCheck","internalError","abort","clearTimeout","closed","close","messages","isMultiple","signal","method","then","open","data","JSON","stringify","closeModals","location","href","setTimeout","healthCheck","bind","onReceivedHealthcheck","onCanceled","Error","headers","Accept","body","status","getShareResult","debug","isPollingTimeOut","Date","now","result","resultDescription","Promise","R","shareTargetPicker","checkPermission","Array","isArray","length","liff","analytics","url","origin","message","availability","permission","minVer","install","O","ShareTargetPickerModule","module"],"mappings":"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","sourcesContent":["import{__awaiter as t,__generator as e}from\"tslib\";import{CREATE_SUBWINDOW_FAILED as i,EXCEPTION_IN_SUBWINDOW as r,UNAUTHORIZED as o,INVALID_ARGUMENT as n,MAX_NUM_OF_SEND_MESSAGES as s,INVALID_CONFIG as a,FORBIDDEN as l}from\"@liff/consts\";import{qs as h,getOriginOfUrl as u,isIpad as c,createLiffError as f,LiffError as p,compareVersion as d}from\"@liff/util\";import{getConfig as w,getContext as g}from\"@liff/store\";import{isInClient as m}from\"@liff/is-in-client\";import{isLoggedIn as b}from\"@liff/is-logged-in\";import{sendShareTargetPicker as v}from\"@liff/analytics\";import{isSubWindow as y}from\"@liff/is-sub-window\";import{getLineVersion as T}from\"@liff/get-line-version\";import{logger as k}from\"@liff/logger\";import{getEndPoint as P,fetch as C}from\"@liff/server-api\";import{getOS as S}from\"@liff/get-os\";import{messageReceive as I,messageTell as W,removeListen as A}from\"@liff/window-postmessage\";var E=function(){function r(){this.payloadToShareTargetPicker=null,this.popupWindow=null,this.doesWaitForSubwindowResult=!1}return r.getInstance=function(){return r.instance?r.instance.reset():r.instance=new r,r.instance},r.prototype.init=function(i){return t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.liffId=i.referrer.liffId,this.doesWaitForSubwindowResult=!(!i.options||!i.options.waitForSubwindowResult),this.allowPostMessageOrigin=this.initAllowPostMessageOrigin(),this.payloadToShareTargetPicker=this.buildPayloadToShareTargetPicker(i),window.AbortController&&(this.abortController=new window.AbortController),this.prepareAnotherWindow(),[4,this.initOtt()];case 1:return e.sent(),this.initListener(),this.openAnotherWindow(),this.doesWaitForSubwindowResult?[4,this.pollingShareResult()]:[3,3];case 2:return t=e.sent(),this.finalize(),[2,t];case 3:return[2];case 4:return[3,6];case 5:if(r=e.sent(),this.finalize(),\"AbortError\"!==r.name)throw r;return[3,6];case 6:return[2]}}))}))},r.prototype.resetAllVariables=function(){this.liffId=\"\",this.allowPostMessageOrigin=\"\",this.payloadToShareTargetPicker=null,this.ott=\"\",this.popupWindow=null,this.timeoutIDForHealthCheck=null,this.abortController=null,this.internalError=null,this.doesWaitForSubwindowResult=!1},r.prototype.reset=function(){this.finalize(),this.resetAllVariables()},r.prototype.finalize=function(){var t,e;this.abortController&&this.abortController.abort(),m()||(t=this.timeoutIDForHealthCheck,e=this.popupWindow,A(window,\"message.receivedHealthcheck\"),t&&clearTimeout(t),e&&!e.closed&&e.close())},r.prototype.buildPayloadToShareTargetPicker=function(t){return{messages:t.messages,isMultiple:t.isMultiple,referrer:t.referrer}},r.prototype.initAllowPostMessageOrigin=function(t){return void 0===t&&(t=P(\"shareTargetPicker\")),u(t)},r.prototype.initOtt=function(){return t(this,void 0,void 0,(function(){var t,i,r;return e(this,(function(e){switch(e.label){case 0:return this.abortController&&(t=this.abortController.signal),i=P(\"shareTargetPickerOtt\")+\"/\"+this.liffId+\"/ott\",r=this,[4,C(i,{method:\"GET\",signal:t}).then((function(t){return t.ott}))];case 1:return r.ott=e.sent(),[2]}}))}))},r.prototype.prepareAnotherWindow=function(){m()||(\"ios\"!==S()||c()?this.popupWindow=window.open(\"\",\"liffpopup\",\"width=480, height=640, menubar=no, toolbar=no, scrollbars=yes\"):this.popupWindow=window.open())},r.prototype.openAnotherWindow=function(){if(m()&&this.payloadToShareTargetPicker)t=this.liffId,e=this.ott,r=this.payloadToShareTargetPicker,o={liffId:t,ott:e,data:JSON.stringify(r),closeModals:!1},location.href=\"line://picker?\"+h.stringify(o);else{if(this.timeoutIDForHealthCheck=window.setTimeout(this.healthCheck.bind(this),1e3),!this.popupWindow)throw f(i);!function(t,e,i){var r={liffId:e,ott:i};t.location.href=P(\"shareTargetPicker\")+\"?\"+h.stringify(r)}(this.popupWindow,this.liffId,this.ott)}var t,e,r,o},r.prototype.initListener=function(){var t,e;m()||(t=this.onReceivedHealthcheck.bind(this),e=this.allowPostMessageOrigin,I(window,\"receivedHealthcheck\",t,e))},r.prototype.healthCheck=function(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:if(this.popupWindow&&!this.popupWindow.closed)return[3,7];if(!this.doesWaitForSubwindowResult)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.onCanceled()];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),this.internalError=t,[3,4];case 4:return[3,6];case 5:this.finalize(),e.label=6;case 6:return[3,8];case 7:i=this.popupWindow,r=this.allowPostMessageOrigin,W(i,\"healthcheck\",void 0,r),this.timeoutIDForHealthCheck=window.setTimeout(this.healthCheck.bind(this),1e3),e.label=8;case 8:return[2]}var i,r}))}))},r.prototype.onReceivedHealthcheck=function(){if(!this.popupWindow||!this.payloadToShareTargetPicker)throw f(i);var t,e,r;t=this.popupWindow,e=this.payloadToShareTargetPicker,r=this.allowPostMessageOrigin,W(t,\"ready\",e,r)},r.prototype.onCanceled=function(){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:if(m()||!this.ott)throw new Error(\"need to call with ott in client\");return this.abortController&&(t=this.abortController.signal),i={liffId:this.liffId,ott:this.ott},[4,C(P(\"shareTargetPickerResult\")+\"?\"+h.stringify(i),{method:\"POST\",signal:t,headers:{Accept:\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:\"result=CANCEL\"})];case 1:return[2,\"ok\"===e.sent().status]}}))}))},r.prototype.getShareResult=function(){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){if(!this.ott)throw new Error(\"need to call with ott in client\");return this.abortController&&(t=this.abortController.signal),i={liffId:this.liffId,ott:this.ott},k.debug(\"fetch: getShareResult\"),[2,C(P(\"shareTargetPickerResult\")+\"?\"+h.stringify(i),{method:\"GET\",headers:{Accept:\"application/json\"},signal:t})]}))}))},r.isPollingTimeOut=function(t,e){return(e-t)/6e4>=10},r.prototype.pollingShareResult=function(){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:t=Date.now(),e.label=1;case 1:if(r.isPollingTimeOut(t,Date.now()))return[3,4];if(this.internalError)throw this.internalError;return[4,this.getShareResult()];case 2:if((i=e.sent())&&i.result)switch(i.result){case\"SUCCESS\":return[2,{status:\"success\"}];case\"CANCEL\":return[2];case\"FAILURE\":default:throw new Error(i.resultDescription)}return[4,new Promise((function(t){setTimeout(t,500)}))];case 3:return e.sent(),[3,1];case 4:throw new Error(\"Timeout: not finished within 10min\")}}))}))},r}(),R=function(){function i(){var i=this;this.name=\"shareTargetPicker\",this.shareTargetPicker=function(l,h){return void 0===h&&(h={}),t(i,void 0,void 0,(function(){var t,i,u,c,g,y,k;return e(this,(function(e){switch(e.label){case 0:if(t=void 0===h.isMultiple||h.isMultiple,this.checkPermission(),!b())throw f(o,\"Need access_token for api call, Please login first\");if(!l||!Array.isArray(l)||0===l.length)throw f(n,\"no proper argument\");if(l.length>s)throw f(n,\"exceed the limit of num of messages\");if(!(i=w().liffId))throw f(a);window.liff&&(u=window.liff).analytics&&v(u.analytics),e.label=1;case 1:return e.trys.push([1,3,,4]),c=E.getInstance(),g=T(),y={waitForSubwindowResult:!0},m()&&g&&d(g,\"10.11.0\")<0&&(y.waitForSubwindowResult=!1),[4,c.init({messages:l,isMultiple:t,referrer:{liffId:i,url:location.origin},options:y})];case 2:return[2,e.sent()];case 3:throw(k=e.sent())instanceof p?k:f(r,k.message);case 4:return[2]}}))}))},this.checkPermission=function(){if(y())throw f(l,\"The operation is not allowed in the SubWindow\");var t=((g()||{}).availability||{}).shareTargetPicker||{},e=t.permission,i=t.minVer;if(!e)throw m()?f(l,\"Need LINE App \"+i+\" at least or consent on shareTargetPicker usage on LINE developer site\"):f(l,\"Need consent on shareTargetPicker usage on LINE developer site\")}}return i.prototype.install=function(){return this.shareTargetPicker},i}(),O=new R;export{R as ShareTargetPickerModule,O as module};\n"]},"metadata":{},"sourceType":"module"}