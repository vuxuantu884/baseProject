{"ast":null,"code":"import _regeneratorRuntime from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useHistory,useParams}from\"react-router\";import{useTranslation}from\"react-i18next\";import{freePointApi,merchantApi}from\"@api\";import{ComponentFreePointDetail,ComponentPopUpConfirm}from\"@components\";import{PATH_404,enumStatus,enumTypes,PATH_HOME,PATH_SIGN_IN}from\"@configs\";import{selectAuth,setExternalTypes,setLoading,setMainColor,setMerchant,setMerchantID}from\"@redux\";import{useNotify}from\"@utils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var PageFreePoint=function PageFreePoint(){//page hook\nvar _useTranslation=useTranslation(),t=_useTranslation.t;var dispatch=useDispatch();var _useParams=useParams(),id=_useParams.id;var history=useHistory();var _useNotify=useNotify(),error=_useNotify.error,success=_useNotify.success;//page redux\nvar _useSelector=useSelector(selectAuth),auth=_useSelector.auth,externalType=_useSelector.externalType;//page state\nvar _useState=useState(),_useState2=_slicedToArray(_useState,2),freePoint=_useState2[0],setFreePoint=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showConfirm=_useState4[0],setShowConfirm=_useState4[1];//page variable\nvar token=auth===null||auth===void 0?void 0:auth.accessToken;useEffect(function(){useFreePoint();},[]);var useFreePoint=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data,_res,_data,merchantConfig,merchant;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch(setLoading(true));if(!id){_context.next=27;break;}if(!token){_context.next=12;break;}_context.next=6;return freePointApi.getPreviewFreePoint(id);case 6:res=_context.sent;data=res.data;setFreePoint(data);dispatch(setExternalTypes({type:(externalType===null||externalType===void 0?void 0:externalType.type)||enumTypes.FREE_POINT,id:\"\"}));_context.next=25;break;case 12:_context.next=14;return merchantApi.getFreePointId(id);case 14:_res=_context.sent;_data=_res.data;dispatch(setMerchantID(_data.merchantId));_context.next=19;return merchantApi.getMerchantConfig();case 19:merchantConfig=_context.sent;merchant=merchantConfig.data.merchant;dispatch(setMerchant(merchant));dispatch(setMainColor(merchant.themeColor));dispatch(setExternalTypes({type:enumTypes.COUPON,id:id}));history.push(PATH_SIGN_IN);case 25:_context.next=28;break;case 27:history.push(PATH_404);case 28:_context.next=33;break;case 30:_context.prev=30;_context.t0=_context[\"catch\"](0);history.push(PATH_404);case 33:_context.prev=33;dispatch(setLoading(false));return _context.finish(33);case 36:case\"end\":return _context.stop();}}},_callee,null,[[0,30,33,36]]);}));return function useFreePoint(){return _ref.apply(this,arguments);};}();var handleRedeemedFreePoint=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch(setLoading(true));_context2.next=4;return freePointApi.redeemedFreePoint({objectId:(freePoint===null||freePoint===void 0?void 0:freePoint._id)||\"\",status:enumStatus.ACTIVE,type:enumTypes.FREE_POINT},id);case 4:res=_context2.sent;if(res.data.message){success(res.data.message);}_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);message=_context2.t0.response.data.message;if(message){error(message);}else{error(t(\"message.received.fail\"));}case 12:_context2.prev=12;dispatch(setLoading(false));history.push(PATH_HOME);return _context2.finish(12);case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8,12,16]]);}));return function handleRedeemedFreePoint(){return _ref2.apply(this,arguments);};}();var handleToggleConfirm=function handleToggleConfirm(){setShowConfirm(!showConfirm);};return/*#__PURE__*/_jsxs(_Fragment,{children:[freePoint&&/*#__PURE__*/_jsx(ComponentFreePointDetail,{freePoint:freePoint,handleToggleConfirm:handleToggleConfirm}),showConfirm&&freePoint&&/*#__PURE__*/_jsx(ComponentPopUpConfirm,{handleCloseDetail:handleToggleConfirm,data:freePoint,handleConfirm:handleRedeemedFreePoint})]});};","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/src/Pages/Free-point.tsx"],"names":["useEffect","useState","useDispatch","useSelector","useHistory","useParams","useTranslation","freePointApi","merchantApi","ComponentFreePointDetail","ComponentPopUpConfirm","PATH_404","enumStatus","enumTypes","PATH_HOME","PATH_SIGN_IN","selectAuth","setExternalTypes","setLoading","setMainColor","setMerchant","setMerchantID","useNotify","PageFreePoint","t","dispatch","id","history","error","success","auth","externalType","freePoint","setFreePoint","showConfirm","setShowConfirm","token","accessToken","useFreePoint","getPreviewFreePoint","res","data","type","FREE_POINT","getFreePointId","merchantId","getMerchantConfig","merchantConfig","merchant","themeColor","COUPON","push","handleRedeemedFreePoint","redeemedFreePoint","objectId","_id","status","ACTIVE","message","response","handleToggleConfirm"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useHistory, useParams } from \"react-router\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { freePointApi, merchantApi } from \"@api\";\nimport { ComponentFreePointDetail, ComponentPopUpConfirm } from \"@components\";\nimport { PATH_404, enumStatus, enumTypes, PATH_HOME, PATH_SIGN_IN } from \"@configs\";\nimport { IFreePoint, IMerchant, IMerchantQRcode } from \"@interfaces\";\nimport {\n    selectAuth,\n    setExternalTypes,\n    setLoading,\n    setMainColor,\n    setMerchant,\n    setMerchantID,\n} from \"@redux\";\nimport { useNotify } from \"@utils\";\n\nexport const PageFreePoint = () => {\n    //page hook\n    const { t } = useTranslation();\n    const dispatch = useDispatch();\n    const { id } = useParams<{ id: string }>();\n    const history = useHistory();\n    const { error, success } = useNotify();\n    //page redux\n    const { auth, externalType } = useSelector(selectAuth);\n    //page state\n    const [freePoint, setFreePoint] = useState<IFreePoint>();\n    const [showConfirm, setShowConfirm] = useState<boolean>(false);\n    //page variable\n    const token = auth?.accessToken;\n\n    useEffect(() => {\n        useFreePoint();\n    }, []);\n\n    const useFreePoint = async () => {\n        try {\n            dispatch(setLoading(true));\n            if (id) {\n                if (token) {\n                    const res = await freePointApi.getPreviewFreePoint(id);\n                    const data = res.data as IFreePoint;\n                    setFreePoint(data);\n                    dispatch(\n                        setExternalTypes({\n                            type: externalType?.type || enumTypes.FREE_POINT,\n                            id: \"\",\n                        })\n                    );\n                } else {\n                    const res = await merchantApi.getFreePointId(id);\n                    const data = res.data as IMerchantQRcode;\n                    dispatch(setMerchantID(data.merchantId));\n                    const merchantConfig = await merchantApi.getMerchantConfig();\n                    const merchant = merchantConfig.data.merchant as IMerchant;\n                    dispatch(setMerchant(merchant));\n                    dispatch(setMainColor(merchant.themeColor));\n                    dispatch(setExternalTypes({ type: enumTypes.COUPON, id }));\n                    history.push(PATH_SIGN_IN);\n                }\n            } else {\n                history.push(PATH_404);\n            }\n        } catch {\n            history.push(PATH_404);\n        } finally {\n            dispatch(setLoading(false));\n        }\n    };\n\n    const handleRedeemedFreePoint = async () => {\n        try {\n            dispatch(setLoading(true));\n            const res = await freePointApi.redeemedFreePoint(\n                {\n                    objectId: freePoint?._id || \"\",\n                    status: enumStatus.ACTIVE,\n                    type: enumTypes.FREE_POINT,\n                },\n                id\n            );\n            if (res.data.message) {\n                success(res.data.message);\n            }\n        } catch (err: any) {\n            const { message } = err.response.data;\n            if (message) {\n                error(message);\n            } else {\n                error(t(\"message.received.fail\"));\n            }\n        } finally {\n            dispatch(setLoading(false));\n            history.push(PATH_HOME);\n        }\n    };\n\n    const handleToggleConfirm = () => {\n        setShowConfirm(!showConfirm);\n    };\n\n    return (\n        <>\n            {freePoint && (\n                <ComponentFreePointDetail\n                    freePoint={freePoint}\n                    handleToggleConfirm={handleToggleConfirm}\n                />\n            )}\n\n            {showConfirm && freePoint && (\n                <ComponentPopUpConfirm\n                    handleCloseDetail={handleToggleConfirm}\n                    data={freePoint as IFreePoint}\n                    handleConfirm={handleRedeemedFreePoint}\n                />\n            )}\n        </>\n    );\n};\n"]},"metadata":{},"sourceType":"module"}