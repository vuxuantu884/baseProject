{"ast":null,"code":"import _objectSpread from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useDispatch,useSelector}from\"react-redux\";import{useState}from\"react\";import{useFormik}from\"formik\";import*as Yup from\"yup\";import{useTranslation}from\"react-i18next\";import{authApi,merchantApi}from\"@api\";import{ComponentUserSetting,ComponentUserSettingSave}from\"@components\";import{selectAuth,setLoading}from\"@redux\";import{useNotify}from\"@utils\";import{useYup}from\"@validations\";import{_10MB}from\"@configs\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var PageUserSetting=function PageUserSetting(){//page hooks\nvar dispatch=useDispatch();var _useNotify=useNotify(),error=_useNotify.error,success=_useNotify.success;var _useYup=useYup(),YubSUserSetting=_useYup.YubSUserSetting;var _useTranslation=useTranslation(),t=_useTranslation.t;//redux state\nvar _useSelector=useSelector(selectAuth),userInfo=_useSelector.userInfo;//page state\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),title=_useState2[0],setTitle=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),errorPhone=_useState4[0],setError=_useState4[1];//page variable\nvar contact=userInfo===null||userInfo===void 0?void 0:userInfo.contact;var initialValue={avatar:(userInfo===null||userInfo===void 0?void 0:userInfo.avatar)||\"\",fullName:(contact===null||contact===void 0?void 0:contact.fullName)||\"\",dateOfBirth:(contact===null||contact===void 0?void 0:contact.dateOfBirth)||new Date(Date.now()),phoneNumber:(contact===null||contact===void 0?void 0:contact.phoneNumber)||\"\",email:(contact===null||contact===void 0?void 0:contact.email)||\"\"};var registerSchema=Yup.object().shape(YubSUserSetting);var handleUploadImage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var values,formData,res,data,mess;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(setLoading(true));//@ts-ignore\nvalues=(e===null||e===void 0?void 0:e.target.files[0])||\"\";if(!(values.size>=_10MB)){_context.next=5;break;}error(t(\"page.image.max_size\"));return _context.abrupt(\"return\");case 5:formData=new FormData();formData.append(\"file\",values);_context.prev=7;_context.next=10;return merchantApi.uploadImage(formData);case 10:res=_context.sent;_context.next=13;return authApi.updateProfile({avatar:res.data.publicUrl});case 13:setFieldValue(\"avatar\",res.data.publicUrl);_context.next=21;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](7);data=_context.t0.response.data;mess=Array.isArray(data.errors)?data.errors[0]:data.message;error(mess);case 21:_context.prev=21;dispatch(setLoading(false));return _context.finish(21);case 24:case\"end\":return _context.stop();}}},_callee,null,[[7,16,21,24]]);}));return function handleUploadImage(_x){return _ref.apply(this,arguments);};}();var handleSaveSetting=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values,_ref2){var setSubmitting,res,errorsResponse;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setSubmitting=_ref2.setSubmitting;if(!errorPhone){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:if(values.phoneNumber){_context2.next=6;break;}setError(t(\"validation.isNumber\"));return _context2.abrupt(\"return\");case 6:if(values.dateOfBirth){_context2.next=8;break;}return _context2.abrupt(\"return\");case 8:_context2.prev=8;setSubmitting(true);dispatch(setLoading(true));_context2.next=13;return authApi.updateProfile(_objectSpread(_objectSpread({},values),{},{phoneNumber:values.phone}));case 13:res=_context2.sent;if(res.data.message){success(res.data.message);}else{success(t(\"message.update.success\"));}setFieldValue(\"phoneNumber\",values.phone||\"\");_context2.next=22;break;case 18:_context2.prev=18;_context2.t0=_context2[\"catch\"](8);errorsResponse=_context2.t0.response.data.errors;if(Array.isArray(errorsResponse)&&errorsResponse.length){error(errorsResponse[0]);}else{error(t(\"message.update.fail\"));}case 22:_context2.prev=22;setTitle(\"\");setSubmitting(false);dispatch(setLoading(false));return _context2.finish(22);case 27:case\"end\":return _context2.stop();}}},_callee2,null,[[8,18,22,27]]);}));return function handleSaveSetting(_x2,_x3){return _ref3.apply(this,arguments);};}();var handleChangeTitle=function handleChangeTitle(title){setTitle(title);};var _useFormik=useFormik({initialValues:initialValue,validationSchema:registerSchema,onSubmit:handleSaveSetting,enableReinitialize:true}),values=_useFormik.values,handleChange=_useFormik.handleChange,handleBlur=_useFormik.handleBlur,handleSubmit=_useFormik.handleSubmit,isSubmitting=_useFormik.isSubmitting,errors=_useFormik.errors,touched=_useFormik.touched,setFieldValue=_useFormik.setFieldValue,setFieldTouched=_useFormik.setFieldTouched;var handleChangeDate=function handleChangeDate(date,dateString){if(dateString){setFieldValue(\"dateOfBirth\",dateString);}else{setFieldValue(\"dateOfBirth\",new Date(Date.now()));}};return/*#__PURE__*/_jsx(_Fragment,{children:title?/*#__PURE__*/_jsx(ComponentUserSettingSave,{values:values,handleChange:handleChange,handleBlur:handleBlur,handleSubmit:handleSubmit,isSubmitting:isSubmitting,errors:errors,touched:touched,title:title,setFieldTouched:setFieldTouched,errorPhone:errorPhone||\"\",handleChangeDate:handleChangeDate,setFieldValue:setFieldValue,setError:setError}):/*#__PURE__*/_jsx(ComponentUserSetting,{handleUploadImage:handleUploadImage,values:values,handleChangeTitle:handleChangeTitle})});};","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/src/Pages/user/Setting.tsx"],"names":["useDispatch","useSelector","useState","useFormik","Yup","useTranslation","authApi","merchantApi","ComponentUserSetting","ComponentUserSettingSave","selectAuth","setLoading","useNotify","useYup","_10MB","PageUserSetting","dispatch","error","success","YubSUserSetting","t","userInfo","title","setTitle","errorPhone","setError","contact","initialValue","avatar","fullName","dateOfBirth","Date","now","phoneNumber","email","registerSchema","object","shape","handleUploadImage","e","values","target","files","size","formData","FormData","append","uploadImage","res","updateProfile","data","publicUrl","setFieldValue","response","mess","Array","isArray","errors","message","handleSaveSetting","setSubmitting","phone","errorsResponse","length","handleChangeTitle","initialValues","validationSchema","onSubmit","enableReinitialize","handleChange","handleBlur","handleSubmit","isSubmitting","touched","setFieldTouched","handleChangeDate","date","dateString"],"mappings":"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","sourcesContent":["import { useDispatch, useSelector } from \"react-redux\";\nimport { useState } from \"react\";\nimport { FormikHelpers, useFormik } from \"formik\";\nimport * as Yup from \"yup\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { authApi, merchantApi } from \"@api\";\nimport { ComponentUserSetting, ComponentUserSettingSave } from \"@components\";\nimport { selectAuth, setLoading } from \"@redux\";\nimport { useNotify } from \"@utils\";\nimport { IUserSetting } from \"@interfaces\";\nimport { useYup } from \"@validations\";\nimport { enumUseSetting, _10MB } from \"@configs\";\n\nexport const PageUserSetting = () => {\n    //page hooks\n    const dispatch = useDispatch();\n    const { error, success } = useNotify();\n    const { YubSUserSetting } = useYup();\n    const { t } = useTranslation();\n    //redux state\n    const { userInfo } = useSelector(selectAuth);\n    //page state\n    const [title, setTitle] = useState<enumUseSetting | \"\">(\"\");\n    const [errorPhone, setError] = useState<string>();\n\n    //page variable\n\n    const contact = userInfo?.contact;\n    const initialValue: IUserSetting = {\n        avatar: userInfo?.avatar || \"\",\n        fullName: contact?.fullName || \"\",\n        dateOfBirth: contact?.dateOfBirth || new Date(Date.now()),\n        phoneNumber: contact?.phoneNumber || \"\",\n        email: contact?.email || \"\",\n    };\n    const registerSchema = Yup.object().shape(YubSUserSetting);\n\n    const handleUploadImage = async (e: React.ChangeEvent<HTMLInputElement> | undefined) => {\n        dispatch(setLoading(true));\n        //@ts-ignore\n        const values = (e?.target.files[0] as File) || \"\";\n        if (values.size >= _10MB) {\n            error(t(\"page.image.max_size\"));\n            return;\n        }\n        const formData = new FormData();\n        formData.append(\"file\", values);\n        try {\n            const res = await merchantApi.uploadImage(formData);\n            await authApi.updateProfile({\n                avatar: res.data.publicUrl,\n            });\n            setFieldValue(\"avatar\", res.data.publicUrl);\n        } catch (err: any) {\n            const data = err.response.data;\n            const mess = Array.isArray(data.errors) ? data.errors[0] : data.message;\n            error(mess);\n        } finally {\n            dispatch(setLoading(false));\n        }\n    };\n\n    const handleSaveSetting = async (\n        values: IUserSetting,\n        { setSubmitting }: FormikHelpers<IUserSetting>\n    ) => {\n        if (errorPhone) return;\n        if (!values.phoneNumber) {\n            setError(t(\"validation.isNumber\"));\n            return;\n        }\n\n        if (!values.dateOfBirth) return;\n\n        try {\n            setSubmitting(true);\n            dispatch(setLoading(true));\n            const res = await authApi.updateProfile({ ...values, phoneNumber: values.phone });\n            if (res.data.message) {\n                success(res.data.message);\n            } else {\n                success(t(\"message.update.success\"));\n            }\n            setFieldValue(\"phoneNumber\", values.phone || \"\");\n        } catch (errors: any) {\n            const errorsResponse = errors.response.data.errors;\n            if (Array.isArray(errorsResponse) && errorsResponse.length) {\n                error(errorsResponse[0]);\n            } else {\n                error(t(\"message.update.fail\"));\n            }\n        } finally {\n            setTitle(\"\");\n            setSubmitting(false);\n            dispatch(setLoading(false));\n        }\n    };\n\n    const handleChangeTitle = (title: enumUseSetting) => {\n        setTitle(title);\n    };\n\n    const {\n        values,\n        handleChange,\n        handleBlur,\n        handleSubmit,\n        isSubmitting,\n        errors,\n        touched,\n        setFieldValue,\n        setFieldTouched,\n    } = useFormik({\n        initialValues: initialValue,\n        validationSchema: registerSchema,\n        onSubmit: handleSaveSetting,\n        enableReinitialize: true,\n    });\n\n    const handleChangeDate = (date: moment.Moment, dateString: string) => {\n        if (dateString) {\n            setFieldValue(\"dateOfBirth\", dateString);\n        } else {\n            setFieldValue(\"dateOfBirth\", new Date(Date.now()));\n        }\n    };\n\n    return (\n        <>\n            {title ? (\n                <ComponentUserSettingSave\n                    values={values}\n                    handleChange={handleChange}\n                    handleBlur={handleBlur}\n                    handleSubmit={handleSubmit}\n                    isSubmitting={isSubmitting}\n                    errors={errors}\n                    touched={touched}\n                    title={title}\n                    setFieldTouched={setFieldTouched}\n                    errorPhone={errorPhone || \"\"}\n                    handleChangeDate={handleChangeDate}\n                    setFieldValue={setFieldValue}\n                    setError={setError}\n                />\n            ) : (\n                <ComponentUserSetting\n                    handleUploadImage={handleUploadImage}\n                    values={values}\n                    handleChangeTitle={handleChangeTitle}\n                />\n            )}\n        </>\n    );\n};\n"]},"metadata":{},"sourceType":"module"}