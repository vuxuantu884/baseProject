{"ast":null,"code":"import _regeneratorRuntime from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useHistory,useParams}from\"react-router\";import{useTranslation}from\"react-i18next\";import{benefitApi}from\"@api\";import{ComponentBenefitDetail,ComponentPopUpConfirm}from\"@components\";import{enumStatus,enumTypes,enumValidation,PATH_HOME}from\"@configs\";import{selectMerchant,setLoading}from\"@redux\";import{useNotify}from\"@utils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var PageBenefit=function PageBenefit(){//page hook\nvar _useTranslation=useTranslation(),t=_useTranslation.t;var dispatch=useDispatch();var _useParams=useParams(),id=_useParams.id;var _useNotify=useNotify(),error=_useNotify.error,success=_useNotify.success;var history=useHistory();//redux state\nvar _useSelector=useSelector(selectMerchant),membershipTiers=_useSelector.membershipTiers;//page state\nvar _useState=useState(),_useState2=_slicedToArray(_useState,2),benefit=_useState2[0],setBenefit=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dataRanks=_useState4[0],setDataRanks=_useState4[1];var _useState5=useState(enumValidation.NUMBER_ONE),_useState6=_slicedToArray(_useState5,2),currentImage=_useState6[0],setCurrentImage=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showConfirm=_useState8[0],setShowConfirm=_useState8[1];//page variable\nvar levelIds=benefit===null||benefit===void 0?void 0:benefit.levelIds;useEffect(function(){if((levelIds===null||levelIds===void 0?void 0:levelIds.length)===0){setDataRanks(membershipTiers||[]);}else{levelIds===null||levelIds===void 0?void 0:levelIds.forEach(function(item){//\nvar check=(membershipTiers===null||membershipTiers===void 0?void 0:membershipTiers.findIndex(function(value){return value._id===item;}))||0;if(check>=0&&membershipTiers){dataRanks.push(membershipTiers[check]);}});setDataRanks(_toConsumableArray(dataRanks));}},[benefit]);useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(setLoading(true));_context.next=3;return benefitApi.getDetailBenefitById(id);case 3:res=_context.sent;data=res.data;setBenefit(data);dispatch(setLoading(false));case 7:case\"end\":return _context.stop();}}},_callee);}))();},[]);var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch(setLoading(true));_context2.next=4;return benefitApi.redeemed({objectId:(benefit===null||benefit===void 0?void 0:benefit._id)||\"\",status:enumStatus.ACTIVE,type:enumTypes.BENEFIT});case 4:res=_context2.sent;if(res.data.message){success(res.data.message);}history.push(PATH_HOME);_context2.next=14;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);message=_context2.t0.response.data.message;if(message){error(message);}else{error(t(\"message.use_coupon.fail\"));}history.push(PATH_HOME);case 14:_context2.prev=14;dispatch(setLoading(false));return _context2.finish(14);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9,14,17]]);}));return function handleClick(){return _ref2.apply(this,arguments);};}();var handleChangeImage=function handleChangeImage(swiper){setCurrentImage(swiper.realIndex+1);};var handleToggleConfirm=function handleToggleConfirm(){setShowConfirm(!showConfirm);};return/*#__PURE__*/_jsxs(_Fragment,{children:[benefit&&/*#__PURE__*/_jsx(ComponentBenefitDetail,{data:benefit,handleToggleConfirm:handleToggleConfirm,dataRanks:dataRanks,handleChangeImage:handleChangeImage,currentImage:currentImage}),showConfirm&&benefit&&/*#__PURE__*/_jsx(ComponentPopUpConfirm,{handleCloseDetail:handleToggleConfirm,data:benefit,handleConfirm:handleClick})]});};","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/src/Pages/Benefit.tsx"],"names":["useEffect","useState","useDispatch","useSelector","useHistory","useParams","useTranslation","benefitApi","ComponentBenefitDetail","ComponentPopUpConfirm","enumStatus","enumTypes","enumValidation","PATH_HOME","selectMerchant","setLoading","useNotify","PageBenefit","t","dispatch","id","error","success","history","membershipTiers","benefit","setBenefit","dataRanks","setDataRanks","NUMBER_ONE","currentImage","setCurrentImage","showConfirm","setShowConfirm","levelIds","length","forEach","item","check","findIndex","value","_id","push","getDetailBenefitById","res","data","handleClick","redeemed","objectId","status","ACTIVE","type","BENEFIT","message","response","handleChangeImage","swiper","realIndex","handleToggleConfirm"],"mappings":"iqBAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,UAAT,CAAqBC,SAArB,KAAsC,cAAtC,CACA,OAASC,cAAT,KAA+B,eAA/B,CAGA,OAASC,UAAT,KAA2B,MAA3B,CACA,OAASC,sBAAT,CAAiCC,qBAAjC,KAA8D,aAA9D,CACA,OAASC,UAAT,CAAqBC,SAArB,CAAgCC,cAAhC,CAAgDC,SAAhD,KAAiE,UAAjE,CAEA,OAASC,cAAT,CAAyBC,UAAzB,KAA2C,QAA3C,CACA,OAASC,SAAT,KAA0B,QAA1B,C,6IAEA,MAAO,IAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CAC7B;AACA,oBAAcX,cAAc,EAA5B,CAAQY,CAAR,iBAAQA,CAAR,CACA,GAAMC,CAAAA,QAAQ,CAAGjB,WAAW,EAA5B,CACA,eAAeG,SAAS,EAAxB,CAAQe,EAAR,YAAQA,EAAR,CACA,eAA2BJ,SAAS,EAApC,CAAQK,KAAR,YAAQA,KAAR,CAAeC,OAAf,YAAeA,OAAf,CACA,GAAMC,CAAAA,OAAO,CAAGnB,UAAU,EAA1B,CACA;AACA,iBAA4BD,WAAW,CAACW,cAAD,CAAvC,CAAQU,eAAR,cAAQA,eAAR,CACA;AACA,cAA8BvB,QAAQ,EAAtC,wCAAOwB,OAAP,eAAgBC,UAAhB,eACA,eAAkCzB,QAAQ,CAAoB,EAApB,CAA1C,yCAAO0B,SAAP,eAAkBC,YAAlB,eACA,eAAwC3B,QAAQ,CAASW,cAAc,CAACiB,UAAxB,CAAhD,yCAAOC,YAAP,eAAqBC,eAArB,eACA,eAAsC9B,QAAQ,CAAU,KAAV,CAA9C,yCAAO+B,WAAP,eAAoBC,cAApB,eACA;AACA,GAAMC,CAAAA,QAAQ,CAAGT,OAAH,SAAGA,OAAH,iBAAGA,OAAO,CAAES,QAA1B,CAEAlC,SAAS,CAAC,UAAM,CACZ,GAAI,CAAAkC,QAAQ,OAAR,EAAAA,QAAQ,SAAR,QAAAA,QAAQ,CAAEC,MAAV,IAAqB,CAAzB,CAA4B,CACxBP,YAAY,CAACJ,eAAe,EAAI,EAApB,CAAZ,CACH,CAFD,IAEO,CACHU,QAAQ,OAAR,EAAAA,QAAQ,SAAR,QAAAA,QAAQ,CAAEE,OAAV,CAAkB,SAACC,IAAD,CAAU,CACxB;AACA,GAAMC,CAAAA,KAAK,CAAG,CAAAd,eAAe,OAAf,EAAAA,eAAe,SAAf,QAAAA,eAAe,CAAEe,SAAjB,CAA2B,SAACC,KAAD,QAAWA,CAAAA,KAAK,CAACC,GAAN,GAAcJ,IAAzB,EAA3B,IAA6D,CAA3E,CACA,GAAIC,KAAK,EAAI,CAAT,EAAcd,eAAlB,CAAmC,CAC/BG,SAAS,CAACe,IAAV,CAAelB,eAAe,CAACc,KAAD,CAA9B,EACH,CACJ,CAND,EAOAV,YAAY,oBAAKD,SAAL,EAAZ,CACH,CACJ,CAbQ,CAaN,CAACF,OAAD,CAbM,CAAT,CAeAzB,SAAS,CAAC,UAAM,CACZ,wDAAC,gJACGmB,QAAQ,CAACJ,UAAU,CAAC,IAAD,CAAX,CAAR,CADH,sBAEqBR,CAAAA,UAAU,CAACoC,oBAAX,CAAgCvB,EAAhC,CAFrB,QAESwB,GAFT,eAGSC,IAHT,CAGgBD,GAAG,CAACC,IAHpB,CAIGnB,UAAU,CAACmB,IAAD,CAAV,CAEA1B,QAAQ,CAACJ,UAAU,CAAC,KAAD,CAAX,CAAR,CANH,sDAAD,KAQH,CATQ,CASN,EATM,CAAT,CAWA,GAAM+B,CAAAA,WAAW,2FAAG,yKAEZ3B,QAAQ,CAACJ,UAAU,CAAC,IAAD,CAAX,CAAR,CAFY,uBAGMR,CAAAA,UAAU,CAACwC,QAAX,CAAoB,CAClCC,QAAQ,CAAE,CAAAvB,OAAO,OAAP,EAAAA,OAAO,SAAP,QAAAA,OAAO,CAAEgB,GAAT,GAAgB,EADQ,CAElCQ,MAAM,CAAEvC,UAAU,CAACwC,MAFe,CAGlCC,IAAI,CAAExC,SAAS,CAACyC,OAHkB,CAApB,CAHN,QAGNR,GAHM,gBAQZ,GAAIA,GAAG,CAACC,IAAJ,CAASQ,OAAb,CAAsB,CAClB/B,OAAO,CAACsB,GAAG,CAACC,IAAJ,CAASQ,OAAV,CAAP,CACH,CACD9B,OAAO,CAACmB,IAAR,CAAa7B,SAAb,EAXY,mFAaJwC,OAbI,CAaQ,aAAIC,QAAJ,CAAaT,IAbrB,CAaJQ,OAbI,CAcZ,GAAIA,OAAJ,CAAa,CACThC,KAAK,CAACgC,OAAD,CAAL,CACH,CAFD,IAEO,CACHhC,KAAK,CAACH,CAAC,CAAC,yBAAD,CAAF,CAAL,CACH,CACDK,OAAO,CAACmB,IAAR,CAAa7B,SAAb,EAnBY,0BAqBZM,QAAQ,CAACJ,UAAU,CAAC,KAAD,CAAX,CAAR,CArBY,wGAAH,kBAAX+B,CAAAA,WAAW,2CAAjB,CAyBA,GAAMS,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,MAAD,CAAwB,CAC9CzB,eAAe,CAACyB,MAAM,CAACC,SAAP,CAAmB,CAApB,CAAf,CACH,CAFD,CAIA,GAAMC,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,EAAM,CAC9BzB,cAAc,CAAC,CAACD,WAAF,CAAd,CACH,CAFD,CAIA,mBACI,2BACKP,OAAO,eACJ,KAAC,sBAAD,EACI,IAAI,CAAEA,OADV,CAEI,mBAAmB,CAAEiC,mBAFzB,CAGI,SAAS,CAAE/B,SAHf,CAII,iBAAiB,CAAE4B,iBAJvB,CAKI,YAAY,CAAEzB,YALlB,EAFR,CAUKE,WAAW,EAAIP,OAAf,eACG,KAAC,qBAAD,EACI,iBAAiB,CAAEiC,mBADvB,CAEI,IAAI,CAAEjC,OAFV,CAGI,aAAa,CAAEqB,WAHnB,EAXR,GADJ,CAoBH,CAhGM","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useHistory, useParams } from \"react-router\";\nimport { useTranslation } from \"react-i18next\";\nimport SwiperCore from \"swiper\";\n\nimport { benefitApi } from \"@api\";\nimport { ComponentBenefitDetail, ComponentPopUpConfirm } from \"@components\";\nimport { enumStatus, enumTypes, enumValidation, PATH_HOME } from \"@configs\";\nimport { IBenefit, IMembershipTier } from \"@interfaces\";\nimport { selectMerchant, setLoading } from \"@redux\";\nimport { useNotify } from \"@utils\";\n\nexport const PageBenefit = () => {\n    //page hook\n    const { t } = useTranslation();\n    const dispatch = useDispatch();\n    const { id } = useParams<{ id: string }>();\n    const { error, success } = useNotify();\n    const history = useHistory();\n    //redux state\n    const { membershipTiers } = useSelector(selectMerchant);\n    //page state\n    const [benefit, setBenefit] = useState<IBenefit>();\n    const [dataRanks, setDataRanks] = useState<IMembershipTier[]>([]);\n    const [currentImage, setCurrentImage] = useState<number>(enumValidation.NUMBER_ONE);\n    const [showConfirm, setShowConfirm] = useState<boolean>(false);\n    //page variable\n    const levelIds = benefit?.levelIds;\n\n    useEffect(() => {\n        if (levelIds?.length === 0) {\n            setDataRanks(membershipTiers || []);\n        } else {\n            levelIds?.forEach((item) => {\n                //\n                const check = membershipTiers?.findIndex((value) => value._id === item) || 0;\n                if (check >= 0 && membershipTiers) {\n                    dataRanks.push(membershipTiers[check]);\n                }\n            });\n            setDataRanks([...dataRanks]);\n        }\n    }, [benefit]);\n\n    useEffect(() => {\n        (async () => {\n            dispatch(setLoading(true));\n            const res = await benefitApi.getDetailBenefitById(id);\n            const data = res.data as IBenefit;\n            setBenefit(data);\n\n            dispatch(setLoading(false));\n        })();\n    }, []);\n\n    const handleClick = async () => {\n        try {\n            dispatch(setLoading(true));\n            const res = await benefitApi.redeemed({\n                objectId: benefit?._id || \"\",\n                status: enumStatus.ACTIVE,\n                type: enumTypes.BENEFIT,\n            });\n            if (res.data.message) {\n                success(res.data.message);\n            }\n            history.push(PATH_HOME);\n        } catch (err: any) {\n            const { message } = err.response.data;\n            if (message) {\n                error(message);\n            } else {\n                error(t(\"message.use_coupon.fail\"));\n            }\n            history.push(PATH_HOME);\n        } finally {\n            dispatch(setLoading(false));\n        }\n    };\n\n    const handleChangeImage = (swiper: SwiperCore) => {\n        setCurrentImage(swiper.realIndex + 1);\n    };\n\n    const handleToggleConfirm = () => {\n        setShowConfirm(!showConfirm);\n    };\n\n    return (\n        <>\n            {benefit && (\n                <ComponentBenefitDetail\n                    data={benefit}\n                    handleToggleConfirm={handleToggleConfirm}\n                    dataRanks={dataRanks}\n                    handleChangeImage={handleChangeImage}\n                    currentImage={currentImage}\n                />\n            )}\n            {showConfirm && benefit && (\n                <ComponentPopUpConfirm\n                    handleCloseDetail={handleToggleConfirm}\n                    data={benefit as IBenefit}\n                    handleConfirm={handleClick}\n                />\n            )}\n        </>\n    );\n};\n"]},"metadata":{},"sourceType":"module"}