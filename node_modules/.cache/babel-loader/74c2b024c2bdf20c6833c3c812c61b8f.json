{"ast":null,"code":"import { STORE_KEY as e, INVALID_CONFIG as t, EXCEPTION_IN_SUBWINDOW as n, SUB_WINDOW_SUBMIT_STATUS as r, SUB_WINDOW_CANCEL_STATUS as i, INVALID_ARGUMENT as o, SUB_WINDOW_IDNTIFICATION_KEY as s, CREATE_SUBWINDOW_FAILED as u, SUB_WINDOW_HEALTH_CHECK_INTERVAL as a, SUB_WINDOW_MONITOR_CLOSE_INTERVAL as c, SUB_WINDOW_HEALTH_CHECK_MESSAGE as f, SUB_WINDOW_CLOSE_STATUS as l, UNKNOWN as m, SUB_WINDOW_ERROR_STATUS as d, UNAUTHORIZED as p, SUB_WINDOW_MODAL_SCHEME_URL as v, FORBIDDEN as h } from \"@liff/consts\";\nimport { createLiffError as w, inMemoryStorage as g, extractLiffId as b, isIpad as y } from \"@liff/util\";\nimport { isInClient as S } from \"@liff/is-in-client\";\nimport { isApiAvailable as I } from \"@liff/is-api-available\";\nimport { __awaiter as P, __generator as O, __spread as C, __read as L } from \"tslib\";\nimport { logger as j } from \"@liff/logger\";\nimport { getOS as E } from \"@liff/get-os\";\nimport { fetch as N, getEndPoint as W, requestWithoutErrorHandling as J } from \"@liff/server-api\";\nimport { getConfig as D, getMSTChallenge as T, getMST as x, getAppData as M } from \"@liff/store\";\nimport { isSubWindow as B } from \"@liff/is-sub-window\";\nimport { closeWindow as U } from \"@liff/close-window\";\n\nfunction k(e) {\n  var t = W(\"subWindowGetOrigin\");\n  return N(t(e));\n}\n\nvar G = {};\n\nfunction K(e, t) {\n  e && G[e] && G[e].forEach(function (e) {\n    e(t);\n  });\n}\n\nvar A,\n    R,\n    V,\n    F,\n    _ = function () {\n  function n(e) {\n    this.storage = e;\n  }\n\n  return n.prototype.getItem = function (e) {\n    return this.storage.getItem(this.getKeyPrefix() + \":\" + e);\n  }, n.prototype.setItem = function (e, t) {\n    this.storage.setItem(this.getKeyPrefix() + \":\" + e, t);\n  }, n.prototype.removeItem = function (e) {\n    this.storage.removeItem(this.getKeyPrefix() + \":\" + e);\n  }, n.prototype.clear = function () {\n    this.storage.clear();\n  }, n.prototype.getKeyPrefix = function () {\n    return e + \":\" + this.getLiffId();\n  }, n.prototype.getLiffId = function () {\n    var e = D().liffId;\n    if (!e) throw w(t, \"liffId is necessary for liff.init()\");\n    return e;\n  }, n;\n}(),\n    q = new _(g);\n\nfunction z() {\n  var e = q.getItem(\"subWindowStatusUpdated\");\n  return null !== e && JSON.parse(e);\n}\n\nfunction H(e) {\n  q.setItem(\"subWindowStatusUpdated\", String(e));\n}\n\nfunction Q(e) {\n  A = e;\n}\n\nfunction X() {\n  return A;\n}\n\nfunction Y() {\n  return V;\n}\n\nfunction Z() {\n  return F;\n}\n\nvar $ = new _(window.sessionStorage);\n\nfunction ee(e) {\n  $.setItem(\"mainWindowOrigin\", e);\n}\n\nfunction te() {\n  return $.getItem(\"mainWindowOrigin\");\n}\n\nfunction ne(e, t) {\n  return void 0 === t && (t = {}), P(this, void 0, void 0, function () {\n    var o, s, u, a, c, f, l;\n    return O(this, function (m) {\n      switch (m.label) {\n        case 0:\n          if (o = D().liffId, s = te(), !window.opener || !s || !o) throw w(n);\n          u = !1, m.label = 1;\n\n        case 1:\n          return m.trys.push([1, 3,, 4]), [4, k(o)];\n\n        case 2:\n          return a = m.sent(), u = a.subwindowCommonModule, [3, 4];\n\n        case 3:\n          throw c = m.sent(), j.debug(c), w(n);\n\n        case 4:\n          return f = JSON.stringify(t), l = u ? s : location.origin, [2, new Promise(function (t) {\n            window.addEventListener(\"message\", function n(o) {\n              (function (e) {\n                if (e.data && \"string\" == typeof e.data.type && [r, i].includes(e.data.type)) return !0;\n                return !1;\n              })(o) && (window.removeEventListener(\"message\", n), t({\n                status: e,\n                result: f\n              }));\n            }), window.opener.postMessage({\n              status: e,\n              result: f\n            }, l);\n          })];\n      }\n    });\n  });\n}\n\nfunction re(e) {\n  var t,\n      n = Z();\n\n  if (e.origin === n) {\n    var o = e.data;\n\n    if (o) {\n      var s,\n          u = o.status,\n          a = o.result;\n\n      try {\n        s = JSON.parse(a || \"{}\");\n      } catch (c) {\n        s = {};\n      }\n\n      switch (u) {\n        case f:\n          window.clearInterval(Y());\n          break;\n\n        case i:\n        case r:\n          H(!0), window.clearInterval(Y()), window.removeEventListener(\"message\", re), K(u, s), null === (t = X()) || void 0 === t || t.postMessage({\n            type: u\n          }, Z());\n          break;\n\n        default:\n          j.debug(\"unexpected message\");\n      }\n    }\n  }\n}\n\nfunction ie() {\n  window.clearInterval(R), window.clearInterval(Y()), window.removeEventListener(\"message\", re);\n}\n\nfunction oe(e) {\n  var t = b(e.url);\n  if (!t) return Promise.reject(w(o, \"params.url must be liff url\"));\n  !function () {\n    ie(), H(!1);\n    var e = X();\n    e && (e.close(), Q(null));\n  }();\n  var n,\n      r,\n      i,\n      m,\n      d = e.url,\n      p = e.appData,\n      v = new URL(d);\n  v.searchParams.append(s, \"true\"), v.hostname = (n = v.hostname, r = L(n.split(\".\")), i = r[0], m = r.slice(1), C([i + \"-ext\"], m).join(\".\"));\n  var h = v.toString();\n  return Q(\"ios\" !== E() || y() ? window.open(\"\", \"liffsubwindow\", \"width=480, height=640, menubar=no, toolbar=no, scrollbars=yes\") : window.open()), k(t).then(function (e) {\n    var t,\n        n = e.origin,\n        r = e.subwindowCommonModule,\n        i = X();\n    if (!i) throw w(u);\n    r ? (!function (e) {\n      F = e;\n    }(n), window.addEventListener(\"message\", re), i.location.href = h, t = function (e, t) {\n      var n = X(),\n          r = {\n        type: f\n      };\n      return t && (r.message = JSON.stringify(t)), window.setInterval(function () {\n        null == n || n.postMessage(r, e);\n      }, a);\n    }(n, p), V = t, function (e) {\n      R = e;\n    }(window.setInterval(function () {\n      var e = X();\n      e && e.closed && (ie(), Q(null), !1 === z() && (H(!0), K(l, {})));\n    }, c))) : i.close();\n  });\n}\n\nfunction se(e) {\n  return P(this, void 0, void 0, function () {\n    var t, n, s, u, a, c, f, p, v, h, g;\n    return O(this, function (b) {\n      switch (b.label) {\n        case 0:\n          t = e.msit, n = e.mstChallenge, s = e.onSuccess, u = e.onError, a = e.reconnectCount, c = void 0 === a ? 0 : a, b.label = 1;\n\n        case 1:\n          return b.trys.push([1, 3,, 6]), [4, J(W(\"subWindowSubscribe\"), {\n            method: \"POST\",\n            body: JSON.stringify({\n              msit: t,\n              mstChallenge: n\n            })\n          })];\n\n        case 2:\n          return f = b.sent(), [3, 6];\n\n        case 3:\n          return b.sent(), [4, ue()];\n\n        case 4:\n          return b.sent(), [4, ce(se, {\n            msit: t,\n            mstChallenge: n,\n            onSuccess: s,\n            onError: u,\n            reconnectCount: c += 1\n          })];\n\n        case 5:\n          return b.sent(), [2];\n\n        case 6:\n          return f.status >= 500 ? [4, ue()] : [3, 9];\n\n        case 7:\n          return b.sent(), [4, ce(se, {\n            msit: t,\n            mstChallenge: n,\n            onSuccess: s,\n            onError: u,\n            reconnectCount: c += 1\n          })];\n\n        case 8:\n          return b.sent(), [3, 20];\n\n        case 9:\n          return f.status >= 400 && 500 > f.status ? [4, ae(f)] : [3, 11];\n\n        case 10:\n          return (v = b.sent()) ? (p = v.errorDetail, u(w(o, p))) : u(w(m, \"Some error happened in the server\")), [3, 20];\n\n        case 11:\n          return 200 !== f.status ? [3, 19] : [4, ae(f)];\n\n        case 12:\n          return (v = b.sent()) ? [3, 13] : (u(w(m, \"Some error happened in the server\")), [3, 18]);\n\n        case 13:\n          switch (h = v.status, g = v.result, h) {\n            case d:\n              return [3, 14];\n\n            case l:\n            case i:\n            case r:\n              return [3, 16];\n          }\n\n          return [3, 17];\n\n        case 14:\n          return [4, ce(se, {\n            msit: t,\n            mstChallenge: n,\n            onSuccess: s,\n            onError: u,\n            reconnectCount: c\n          })];\n\n        case 15:\n          return b.sent(), [3, 18];\n\n        case 16:\n          return s(h, g), [3, 18];\n\n        case 17:\n          u(w(m, \"Some error happened in the server\")), b.label = 18;\n\n        case 18:\n          return [3, 20];\n\n        case 19:\n          u(w(m, \"Some error happened in the server\")), b.label = 20;\n\n        case 20:\n          return [2];\n      }\n    });\n  });\n}\n\nfunction ue() {\n  return new Promise(function (e) {\n    return setTimeout(e, 1e3);\n  });\n}\n\nfunction ae(e) {\n  return P(this, void 0, void 0, function () {\n    return O(this, function (t) {\n      switch (t.label) {\n        case 0:\n          return t.trys.push([0, 2,, 3]), [4, e.json()];\n\n        case 1:\n          return [2, t.sent()];\n\n        case 2:\n          return t.sent(), [2, null];\n\n        case 3:\n          return [2];\n      }\n    });\n  });\n}\n\nfunction ce(e, t) {\n  return P(this, void 0, void 0, function () {\n    return O(this, function (n) {\n      switch (n.label) {\n        case 0:\n          return t.reconnectCount >= 10 ? (t.onError(w(m, \"Failed to connect\")), [3, 3]) : [3, 1];\n\n        case 1:\n          return [4, e(t)];\n\n        case 2:\n          n.sent(), n.label = 3;\n\n        case 3:\n          return [2];\n      }\n    });\n  });\n}\n\nfunction fe(e) {\n  var t = {};\n  return Object.keys(e).forEach(function (n) {\n    \"closeButtonColor\" === n ? \"white\" === e[n] ? t[n] = \"#ffffff\" : t[n] = \"#000000\" : t[n] = e[n];\n  }), t;\n}\n\nvar le = {\n  height: \"full\",\n  closeButtonPosition: \"right\",\n  closeButtonColor: \"black\",\n  closeButtonLabel: \"\"\n};\n\nfunction me(e) {\n  var t = e.appData,\n      n = e.native,\n      r = D().liffId,\n      i = T(),\n      s = b(e.url);\n  if (!r) return Promise.reject(w(p, \"liffId is invalid\"));\n  if (!i) return Promise.reject(w(p, \"mst_challenge is invalid\"));\n  if (!s) return Promise.reject(w(o, \"params.url must be liff url\"));\n  var u = Object.assign({}, le, n);\n  return function (e) {\n    var t = e.mainLiffId,\n        n = e.subLiffId,\n        r = e.mstChallenge,\n        i = e.appData,\n        s = e.view;\n    return t && r ? N(W(\"subWindowGetMSIT\"), {\n      method: \"POST\",\n      body: JSON.stringify({\n        mainLiffId: t,\n        subLiffId: n,\n        mstChallenge: r,\n        appData: i,\n        view: s\n      })\n    }) : Promise.reject(w(o, \"no proper argument\"));\n  }({\n    mainLiffId: r,\n    subLiffId: s,\n    mstChallenge: i,\n    appData: t,\n    view: fe(u)\n  }).then(function (t) {\n    var n = t.msit;\n    se({\n      msit: n,\n      mstChallenge: i,\n      onSuccess: function (e, t) {\n        K(e, t);\n      },\n      onError: function (e) {\n        K(d, e);\n      }\n    }), function (e, t) {\n      var n = e.url,\n          r = new URLSearchParams();\n      r.set(\"msit\", t), location.href = v + \"?url=\" + encodeURIComponent(n) + \"&\" + r.toString();\n    }(e, n);\n  });\n}\n\nfunction de() {\n  if (!B()) throw w(p, \"this api can be only called in child window\");\n}\n\nfunction pe(e) {\n  if (!e.mst || !e.status) return Promise.reject(w(o, \"no proper argument\"));\n  var t = JSON.stringify(e);\n  return N(W(\"subWindowPost\"), {\n    method: \"POST\",\n    body: t\n  });\n}\n\nfunction ve(e) {\n  var t = e.msit,\n      n = e.mstVerifier;\n  return t && n ? N(W(\"subWindowGetMSTByMSIT\"), {\n    method: \"POST\",\n    body: JSON.stringify({\n      msit: t,\n      mstVerifier: n\n    })\n  }) : Promise.reject(w(o, \"no proper argument\"));\n}\n\nfunction he(e) {\n  var t = e.mst;\n  return t ? N(W(\"subWindowGetAppData\"), {\n    method: \"POST\",\n    body: JSON.stringify({\n      mst: t\n    })\n  }) : Promise.reject(w(o, \"no proper argument\"));\n}\n\nvar we = {\n  on: function (e, t) {\n    G[e] || (G[e] = []), G[e].push(t);\n  },\n  off: function (e, t) {\n    if (G[e]) {\n      var n = G[e].indexOf(t);\n      n >= 0 && G[e].splice(n, 1);\n    }\n  },\n  open: function (e) {\n    if (!I(\"subwindowOpen\")) throw w(h, \"No permission for liff.subWindow.open()\");\n    return function () {\n      if (B()) throw w(p, \"this api can be only called in parent window\");\n    }(), S() ? me(e) : oe(e);\n  },\n  cancel: function (e) {\n    return void 0 === e && (e = {}), de(), S() ? function (e) {\n      return void 0 === e && (e = {}), P(this, void 0, void 0, function () {\n        var t, n;\n        return O(this, function (r) {\n          switch (r.label) {\n            case 0:\n              return (t = x()) ? [4, pe({\n                mst: t,\n                status: i,\n                result: e\n              })] : [2, Promise.reject(w(p, \"mst is invalid\"))];\n\n            case 1:\n              return n = r.sent(), H(!0), [2, n];\n          }\n        });\n      });\n    }(e) : function (e) {\n      return void 0 === e && (e = {}), ne(i, e);\n    }(e);\n  },\n  submit: function (e) {\n    return void 0 === e && (e = {}), de(), S() ? function (e) {\n      return void 0 === e && (e = {}), P(this, void 0, void 0, function () {\n        var t, n;\n        return O(this, function (i) {\n          switch (i.label) {\n            case 0:\n              return (t = x()) ? [4, pe({\n                mst: t,\n                status: r,\n                result: e\n              })] : [2, Promise.reject(w(p, \"mst is invalid\"))];\n\n            case 1:\n              return n = i.sent(), H(!0), [2, n];\n          }\n        });\n      });\n    }(e) : function (e) {\n      return void 0 === e && (e = {}), ne(r, e);\n    }(e);\n  },\n  close: function () {\n    return de(), S() ? function () {\n      return P(this, void 0, void 0, function () {\n        var e;\n        return O(this, function (t) {\n          switch (t.label) {\n            case 0:\n              return !1 !== z() ? [3, 2] : (e = x()) ? [4, pe({\n                mst: e,\n                status: l,\n                result: {}\n              })] : [2, Promise.reject(w(p, \"mst is invalid\"))];\n\n            case 1:\n              t.sent(), t.label = 2;\n\n            case 2:\n              return U(), [2];\n          }\n        });\n      });\n    }() : (U(), Promise.resolve());\n  },\n  getAppData: function () {\n    return de(), function () {\n      var e,\n          t = M();\n\n      try {\n        e = t ? JSON.parse(t) : {};\n      } catch (n) {\n        e = {};\n      }\n\n      return Promise.resolve(e);\n    }();\n  }\n};\nexport { he as getAppData, ve as getMSTByMSIT, te as getMainWindowOrigin, ee as setMainWindowOrigin, we as subWindow };","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/@liff/sub-window/lib/index.es.js"],"names":["STORE_KEY","e","INVALID_CONFIG","t","EXCEPTION_IN_SUBWINDOW","n","SUB_WINDOW_SUBMIT_STATUS","r","SUB_WINDOW_CANCEL_STATUS","i","INVALID_ARGUMENT","o","SUB_WINDOW_IDNTIFICATION_KEY","s","CREATE_SUBWINDOW_FAILED","u","SUB_WINDOW_HEALTH_CHECK_INTERVAL","a","SUB_WINDOW_MONITOR_CLOSE_INTERVAL","c","SUB_WINDOW_HEALTH_CHECK_MESSAGE","f","SUB_WINDOW_CLOSE_STATUS","l","UNKNOWN","m","SUB_WINDOW_ERROR_STATUS","d","UNAUTHORIZED","p","SUB_WINDOW_MODAL_SCHEME_URL","v","FORBIDDEN","h","createLiffError","w","inMemoryStorage","g","extractLiffId","b","isIpad","y","isInClient","S","isApiAvailable","I","__awaiter","P","__generator","O","__spread","C","__read","L","logger","j","getOS","E","fetch","N","getEndPoint","W","requestWithoutErrorHandling","J","getConfig","D","getMSTChallenge","T","getMST","x","getAppData","M","isSubWindow","B","closeWindow","U","k","G","K","forEach","A","R","V","F","_","storage","prototype","getItem","getKeyPrefix","setItem","removeItem","clear","getLiffId","liffId","q","z","JSON","parse","H","String","Q","X","Y","Z","$","window","sessionStorage","ee","te","ne","label","opener","trys","push","sent","subwindowCommonModule","debug","stringify","location","origin","Promise","addEventListener","data","type","includes","removeEventListener","status","result","postMessage","re","clearInterval","ie","oe","url","reject","close","appData","URL","searchParams","append","hostname","split","slice","join","toString","open","then","href","message","setInterval","closed","se","msit","mstChallenge","onSuccess","onError","reconnectCount","method","body","ue","ce","ae","errorDetail","setTimeout","json","fe","Object","keys","le","height","closeButtonPosition","closeButtonColor","closeButtonLabel","me","native","assign","mainLiffId","subLiffId","view","URLSearchParams","set","encodeURIComponent","de","pe","mst","ve","mstVerifier","he","we","on","off","indexOf","splice","cancel","submit","resolve","getMSTByMSIT","getMainWindowOrigin","setMainWindowOrigin","subWindow"],"mappings":"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","sourcesContent":["import{STORE_KEY as e,INVALID_CONFIG as t,EXCEPTION_IN_SUBWINDOW as n,SUB_WINDOW_SUBMIT_STATUS as r,SUB_WINDOW_CANCEL_STATUS as i,INVALID_ARGUMENT as o,SUB_WINDOW_IDNTIFICATION_KEY as s,CREATE_SUBWINDOW_FAILED as u,SUB_WINDOW_HEALTH_CHECK_INTERVAL as a,SUB_WINDOW_MONITOR_CLOSE_INTERVAL as c,SUB_WINDOW_HEALTH_CHECK_MESSAGE as f,SUB_WINDOW_CLOSE_STATUS as l,UNKNOWN as m,SUB_WINDOW_ERROR_STATUS as d,UNAUTHORIZED as p,SUB_WINDOW_MODAL_SCHEME_URL as v,FORBIDDEN as h}from\"@liff/consts\";import{createLiffError as w,inMemoryStorage as g,extractLiffId as b,isIpad as y}from\"@liff/util\";import{isInClient as S}from\"@liff/is-in-client\";import{isApiAvailable as I}from\"@liff/is-api-available\";import{__awaiter as P,__generator as O,__spread as C,__read as L}from\"tslib\";import{logger as j}from\"@liff/logger\";import{getOS as E}from\"@liff/get-os\";import{fetch as N,getEndPoint as W,requestWithoutErrorHandling as J}from\"@liff/server-api\";import{getConfig as D,getMSTChallenge as T,getMST as x,getAppData as M}from\"@liff/store\";import{isSubWindow as B}from\"@liff/is-sub-window\";import{closeWindow as U}from\"@liff/close-window\";function k(e){var t=W(\"subWindowGetOrigin\");return N(t(e))}var G={};function K(e,t){e&&G[e]&&G[e].forEach((function(e){e(t)}))}var A,R,V,F,_=function(){function n(e){this.storage=e}return n.prototype.getItem=function(e){return this.storage.getItem(this.getKeyPrefix()+\":\"+e)},n.prototype.setItem=function(e,t){this.storage.setItem(this.getKeyPrefix()+\":\"+e,t)},n.prototype.removeItem=function(e){this.storage.removeItem(this.getKeyPrefix()+\":\"+e)},n.prototype.clear=function(){this.storage.clear()},n.prototype.getKeyPrefix=function(){return e+\":\"+this.getLiffId()},n.prototype.getLiffId=function(){var e=D().liffId;if(!e)throw w(t,\"liffId is necessary for liff.init()\");return e},n}(),q=new _(g);function z(){var e=q.getItem(\"subWindowStatusUpdated\");return null!==e&&JSON.parse(e)}function H(e){q.setItem(\"subWindowStatusUpdated\",String(e))}function Q(e){A=e}function X(){return A}function Y(){return V}function Z(){return F}var $=new _(window.sessionStorage);function ee(e){$.setItem(\"mainWindowOrigin\",e)}function te(){return $.getItem(\"mainWindowOrigin\")}function ne(e,t){return void 0===t&&(t={}),P(this,void 0,void 0,(function(){var o,s,u,a,c,f,l;return O(this,(function(m){switch(m.label){case 0:if(o=D().liffId,s=te(),!window.opener||!s||!o)throw w(n);u=!1,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,k(o)];case 2:return a=m.sent(),u=a.subwindowCommonModule,[3,4];case 3:throw c=m.sent(),j.debug(c),w(n);case 4:return f=JSON.stringify(t),l=u?s:location.origin,[2,new Promise((function(t){window.addEventListener(\"message\",(function n(o){(function(e){if(e.data&&\"string\"==typeof e.data.type&&[r,i].includes(e.data.type))return!0;return!1})(o)&&(window.removeEventListener(\"message\",n),t({status:e,result:f}))})),window.opener.postMessage({status:e,result:f},l)}))]}}))}))}function re(e){var t,n=Z();if(e.origin===n){var o=e.data;if(o){var s,u=o.status,a=o.result;try{s=JSON.parse(a||\"{}\")}catch(c){s={}}switch(u){case f:window.clearInterval(Y());break;case i:case r:H(!0),window.clearInterval(Y()),window.removeEventListener(\"message\",re),K(u,s),null===(t=X())||void 0===t||t.postMessage({type:u},Z());break;default:j.debug(\"unexpected message\")}}}}function ie(){window.clearInterval(R),window.clearInterval(Y()),window.removeEventListener(\"message\",re)}function oe(e){var t=b(e.url);if(!t)return Promise.reject(w(o,\"params.url must be liff url\"));!function(){ie(),H(!1);var e=X();e&&(e.close(),Q(null))}();var n,r,i,m,d=e.url,p=e.appData,v=new URL(d);v.searchParams.append(s,\"true\"),v.hostname=(n=v.hostname,r=L(n.split(\".\")),i=r[0],m=r.slice(1),C([i+\"-ext\"],m).join(\".\"));var h=v.toString();return Q(\"ios\"!==E()||y()?window.open(\"\",\"liffsubwindow\",\"width=480, height=640, menubar=no, toolbar=no, scrollbars=yes\"):window.open()),k(t).then((function(e){var t,n=e.origin,r=e.subwindowCommonModule,i=X();if(!i)throw w(u);r?(!function(e){F=e}(n),window.addEventListener(\"message\",re),i.location.href=h,t=function(e,t){var n=X(),r={type:f};return t&&(r.message=JSON.stringify(t)),window.setInterval((function(){null==n||n.postMessage(r,e)}),a)}(n,p),V=t,function(e){R=e}(window.setInterval((function(){var e=X();e&&e.closed&&(ie(),Q(null),!1===z()&&(H(!0),K(l,{})))}),c))):i.close()}))}function se(e){return P(this,void 0,void 0,(function(){var t,n,s,u,a,c,f,p,v,h,g;return O(this,(function(b){switch(b.label){case 0:t=e.msit,n=e.mstChallenge,s=e.onSuccess,u=e.onError,a=e.reconnectCount,c=void 0===a?0:a,b.label=1;case 1:return b.trys.push([1,3,,6]),[4,J(W(\"subWindowSubscribe\"),{method:\"POST\",body:JSON.stringify({msit:t,mstChallenge:n})})];case 2:return f=b.sent(),[3,6];case 3:return b.sent(),[4,ue()];case 4:return b.sent(),[4,ce(se,{msit:t,mstChallenge:n,onSuccess:s,onError:u,reconnectCount:c+=1})];case 5:return b.sent(),[2];case 6:return f.status>=500?[4,ue()]:[3,9];case 7:return b.sent(),[4,ce(se,{msit:t,mstChallenge:n,onSuccess:s,onError:u,reconnectCount:c+=1})];case 8:return b.sent(),[3,20];case 9:return f.status>=400&&500>f.status?[4,ae(f)]:[3,11];case 10:return(v=b.sent())?(p=v.errorDetail,u(w(o,p))):u(w(m,\"Some error happened in the server\")),[3,20];case 11:return 200!==f.status?[3,19]:[4,ae(f)];case 12:return(v=b.sent())?[3,13]:(u(w(m,\"Some error happened in the server\")),[3,18]);case 13:switch(h=v.status,g=v.result,h){case d:return[3,14];case l:case i:case r:return[3,16]}return[3,17];case 14:return[4,ce(se,{msit:t,mstChallenge:n,onSuccess:s,onError:u,reconnectCount:c})];case 15:return b.sent(),[3,18];case 16:return s(h,g),[3,18];case 17:u(w(m,\"Some error happened in the server\")),b.label=18;case 18:return[3,20];case 19:u(w(m,\"Some error happened in the server\")),b.label=20;case 20:return[2]}}))}))}function ue(){return new Promise((function(e){return setTimeout(e,1e3)}))}function ae(e){return P(this,void 0,void 0,(function(){return O(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.json()];case 1:return[2,t.sent()];case 2:return t.sent(),[2,null];case 3:return[2]}}))}))}function ce(e,t){return P(this,void 0,void 0,(function(){return O(this,(function(n){switch(n.label){case 0:return t.reconnectCount>=10?(t.onError(w(m,\"Failed to connect\")),[3,3]):[3,1];case 1:return[4,e(t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}function fe(e){var t={};return Object.keys(e).forEach((function(n){\"closeButtonColor\"===n?\"white\"===e[n]?t[n]=\"#ffffff\":t[n]=\"#000000\":t[n]=e[n]})),t}var le={height:\"full\",closeButtonPosition:\"right\",closeButtonColor:\"black\",closeButtonLabel:\"\"};function me(e){var t=e.appData,n=e.native,r=D().liffId,i=T(),s=b(e.url);if(!r)return Promise.reject(w(p,\"liffId is invalid\"));if(!i)return Promise.reject(w(p,\"mst_challenge is invalid\"));if(!s)return Promise.reject(w(o,\"params.url must be liff url\"));var u=Object.assign({},le,n);return function(e){var t=e.mainLiffId,n=e.subLiffId,r=e.mstChallenge,i=e.appData,s=e.view;return t&&r?N(W(\"subWindowGetMSIT\"),{method:\"POST\",body:JSON.stringify({mainLiffId:t,subLiffId:n,mstChallenge:r,appData:i,view:s})}):Promise.reject(w(o,\"no proper argument\"))}({mainLiffId:r,subLiffId:s,mstChallenge:i,appData:t,view:fe(u)}).then((function(t){var n=t.msit;se({msit:n,mstChallenge:i,onSuccess:function(e,t){K(e,t)},onError:function(e){K(d,e)}}),function(e,t){var n=e.url,r=new URLSearchParams;r.set(\"msit\",t),location.href=v+\"?url=\"+encodeURIComponent(n)+\"&\"+r.toString()}(e,n)}))}function de(){if(!B())throw w(p,\"this api can be only called in child window\")}function pe(e){if(!e.mst||!e.status)return Promise.reject(w(o,\"no proper argument\"));var t=JSON.stringify(e);return N(W(\"subWindowPost\"),{method:\"POST\",body:t})}function ve(e){var t=e.msit,n=e.mstVerifier;return t&&n?N(W(\"subWindowGetMSTByMSIT\"),{method:\"POST\",body:JSON.stringify({msit:t,mstVerifier:n})}):Promise.reject(w(o,\"no proper argument\"))}function he(e){var t=e.mst;return t?N(W(\"subWindowGetAppData\"),{method:\"POST\",body:JSON.stringify({mst:t})}):Promise.reject(w(o,\"no proper argument\"))}var we={on:function(e,t){G[e]||(G[e]=[]),G[e].push(t)},off:function(e,t){if(G[e]){var n=G[e].indexOf(t);n>=0&&G[e].splice(n,1)}},open:function(e){if(!I(\"subwindowOpen\"))throw w(h,\"No permission for liff.subWindow.open()\");return function(){if(B())throw w(p,\"this api can be only called in parent window\")}(),S()?me(e):oe(e)},cancel:function(e){return void 0===e&&(e={}),de(),S()?function(e){return void 0===e&&(e={}),P(this,void 0,void 0,(function(){var t,n;return O(this,(function(r){switch(r.label){case 0:return(t=x())?[4,pe({mst:t,status:i,result:e})]:[2,Promise.reject(w(p,\"mst is invalid\"))];case 1:return n=r.sent(),H(!0),[2,n]}}))}))}(e):function(e){return void 0===e&&(e={}),ne(i,e)}(e)},submit:function(e){return void 0===e&&(e={}),de(),S()?function(e){return void 0===e&&(e={}),P(this,void 0,void 0,(function(){var t,n;return O(this,(function(i){switch(i.label){case 0:return(t=x())?[4,pe({mst:t,status:r,result:e})]:[2,Promise.reject(w(p,\"mst is invalid\"))];case 1:return n=i.sent(),H(!0),[2,n]}}))}))}(e):function(e){return void 0===e&&(e={}),ne(r,e)}(e)},close:function(){return de(),S()?function(){return P(this,void 0,void 0,(function(){var e;return O(this,(function(t){switch(t.label){case 0:return!1!==z()?[3,2]:(e=x())?[4,pe({mst:e,status:l,result:{}})]:[2,Promise.reject(w(p,\"mst is invalid\"))];case 1:t.sent(),t.label=2;case 2:return U(),[2]}}))}))}():(U(),Promise.resolve())},getAppData:function(){return de(),function(){var e,t=M();try{e=t?JSON.parse(t):{}}catch(n){e={}}return Promise.resolve(e)}()}};export{he as getAppData,ve as getMSTByMSIT,te as getMainWindowOrigin,ee as setMainWindowOrigin,we as subWindow};\n"]},"metadata":{},"sourceType":"module"}