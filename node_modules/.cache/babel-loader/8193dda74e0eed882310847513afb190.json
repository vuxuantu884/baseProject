{"ast":null,"code":"import _regeneratorRuntime from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useDispatch,useSelector}from\"react-redux\";import{useEffect,useState}from\"react\";import{useHistory}from\"react-router\";import{ComponentHeaderAuth,ComponentSignUpOTP}from\"@components\";import{selectAuth,setAuth,setLoading}from\"@redux\";import{enumExternalMethod,enumValidation,PATH_SIGN_UP,TIME_RESEND}from\"@configs\";import{authApi}from\"@api\";import{useNotify}from\"@utils\";import{jsx as _jsx}from\"react/jsx-runtime\";export var PageSignUpOTP=function PageSignUpOTP(){//page hook\nvar history=useHistory();var _useNotify=useNotify(),error=_useNotify.error,success=_useNotify.success;var dispatch=useDispatch();//page state\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),otp=_useState2[0],setOtp=_useState2[1];var _useState3=useState(TIME_RESEND),_useState4=_slicedToArray(_useState3,2),timeResend=_useState4[0],setTimeResend=_useState4[1];//redux state\nvar _useSelector=useSelector(selectAuth),externalLogin=_useSelector.externalLogin;//page variable\nvar phoneNumber=window.sessionStorage.getItem(\"phoneNumber\")||\"\";var remember=window.sessionStorage.getItem(\"remember\");useEffect(function(){if(externalLogin!==enumExternalMethod.TEL){history.push(PATH_SIGN_UP);}},[]);var handleChangeOtp=function handleChangeOtp(otp){setOtp(otp);};var handleVerifyOtp=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data,message,_message;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(otp.length<enumValidation.LENTH_OTP)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;dispatch(setLoading(true));_context.next=6;return authApi.verifyPhone({phoneNumber:phoneNumber,code:otp});case 6:res=_context.sent;data=res.data.token;message=res.data.message;if(remember){dispatch(setAuth(data));}else{dispatch(setAuth(_objectSpread(_objectSpread({},data),{},{refreshToken:null})));}success(message);_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](2);_message=_context.t0.response.data.message;error(_message);case 17:_context.prev=17;dispatch(setLoading(false));return _context.finish(17);case 20:case\"end\":return _context.stop();}}},_callee,null,[[2,13,17,20]]);}));return function handleVerifyOtp(){return _ref.apply(this,arguments);};}();var handleResend=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,currentTime,id,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(timeResend!==TIME_RESEND)){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:_context2.prev=2;dispatch(setLoading(true));_context2.next=6;return authApi.resendPhone({phoneNumber:phoneNumber});case 6:res=_context2.sent;if(res.data.message){success(res.data.message);currentTime=timeResend;id=setInterval(function(){currentTime=currentTime-1;setTimeResend(function(){return currentTime;});if(currentTime===0){setTimeResend(TIME_RESEND);clearInterval(id);}},1000);}_context2.next=14;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](2);message=_context2.t0.response.data.message;error(message);case 14:_context2.prev=14;dispatch(setLoading(false));return _context2.finish(14);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[2,10,14,17]]);}));return function handleResend(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(ComponentHeaderAuth,{children:/*#__PURE__*/_jsx(ComponentSignUpOTP,{handleVerifyOtp:handleVerifyOtp,handleChangeOtp:handleChangeOtp,handleResend:handleResend,otp:otp,timeResend:timeResend})});};","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/src/Pages/authentication/Otp.tsx"],"names":["useDispatch","useSelector","useEffect","useState","useHistory","ComponentHeaderAuth","ComponentSignUpOTP","selectAuth","setAuth","setLoading","enumExternalMethod","enumValidation","PATH_SIGN_UP","TIME_RESEND","authApi","useNotify","PageSignUpOTP","history","error","success","dispatch","otp","setOtp","timeResend","setTimeResend","externalLogin","phoneNumber","window","sessionStorage","getItem","remember","TEL","push","handleChangeOtp","handleVerifyOtp","length","LENTH_OTP","verifyPhone","code","res","data","token","message","refreshToken","response","handleResend","resendPhone","currentTime","id","setInterval","clearInterval"],"mappings":"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","sourcesContent":["import { useDispatch, useSelector } from \"react-redux\";\nimport { useEffect, useState } from \"react\";\nimport { useHistory } from \"react-router\";\n\nimport { ComponentHeaderAuth, ComponentSignUpOTP } from \"@components\";\nimport { selectAuth, setAuth, setLoading } from \"@redux\";\nimport { enumExternalMethod, enumValidation, PATH_SIGN_UP, TIME_RESEND } from \"@configs\";\nimport { authApi } from \"@api\";\nimport { useNotify } from \"@utils\";\nimport { IAuth } from \"@interfaces\";\n\nexport const PageSignUpOTP = () => {\n    //page hook\n    const history = useHistory();\n    const { error, success } = useNotify();\n    const dispatch = useDispatch();\n    //page state\n    const [otp, setOtp] = useState<string>(\"\");\n    const [timeResend, setTimeResend] = useState<number>(TIME_RESEND);\n    //redux state\n    const { externalLogin } = useSelector(selectAuth);\n    //page variable\n    const phoneNumber = window.sessionStorage.getItem(\"phoneNumber\") || \"\";\n    const remember = window.sessionStorage.getItem(\"remember\");\n\n    useEffect(() => {\n        if (externalLogin !== enumExternalMethod.TEL) {\n            history.push(PATH_SIGN_UP);\n        }\n    }, []);\n\n    const handleChangeOtp = (otp: string) => {\n        setOtp(otp);\n    };\n\n    const handleVerifyOtp = async () => {\n        if (otp.length < enumValidation.LENTH_OTP) return;\n        try {\n            dispatch(setLoading(true));\n            const res = await authApi.verifyPhone({\n                phoneNumber,\n                code: otp,\n            });\n            const data = res.data.token as IAuth;\n            const message = res.data.message;\n            if (remember) {\n                dispatch(setAuth(data));\n            } else {\n                dispatch(setAuth({ ...data, refreshToken: null }));\n            }\n            success(message);\n        } catch (errors: any) {\n            const { message } = errors.response.data;\n            error(message);\n        } finally {\n            dispatch(setLoading(false));\n        }\n    };\n\n    const handleResend = async () => {\n        if (timeResend !== TIME_RESEND) return;\n        try {\n            dispatch(setLoading(true));\n            const res = await authApi.resendPhone({\n                phoneNumber,\n            });\n            if (res.data.message) {\n                success(res.data.message);\n                let currentTime = timeResend;\n                const id = setInterval(() => {\n                    currentTime = currentTime - 1;\n                    setTimeResend(() => currentTime);\n                    if (currentTime === 0) {\n                        setTimeResend(TIME_RESEND);\n                        clearInterval(id);\n                    }\n                }, 1000);\n            }\n        } catch (errors: any) {\n            const { message } = errors.response.data;\n            error(message);\n        } finally {\n            dispatch(setLoading(false));\n        }\n    };\n\n    return (\n        <ComponentHeaderAuth>\n            <ComponentSignUpOTP\n                handleVerifyOtp={handleVerifyOtp}\n                handleChangeOtp={handleChangeOtp}\n                handleResend={handleResend}\n                otp={otp}\n                timeResend={timeResend}\n            />\n        </ComponentHeaderAuth>\n    );\n};\n"]},"metadata":{},"sourceType":"module"}