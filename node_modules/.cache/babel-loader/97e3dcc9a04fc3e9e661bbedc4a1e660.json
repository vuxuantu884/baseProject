{"ast":null,"code":"import { __awaiter as e, __generator as t, __values as n, __spread as r } from \"tslib\";\nimport { PERMISSION_NAMES as i, INVALID_ARGUMENT as o, UNAUTHORIZED as s, FORBIDDEN as a, UNKNOWN as u } from \"@liff/consts\";\nimport { createLiffError as c, extractChannelIdFromLiffId as f } from \"@liff/util\";\nimport { getContext as l, getAccessToken as h, getConfig as p, setAccessToken as d } from \"@liff/store\";\nimport { verifyAccessToken as v, fetch as m, getEndPoint as w } from \"@liff/server-api\";\nimport { isInClient as b } from \"@liff/is-in-client\";\nimport { subWindow as y } from \"@liff/sub-window\";\nimport { isApiAvailable as g } from \"@liff/is-api-available\";\n\nfunction C(r) {\n  return e(this, void 0, void 0, function () {\n    var e, a, u, f, p, d, m;\n    return t(this, function (t) {\n      switch (t.label) {\n        case 0:\n          return function (e) {\n            if (!i.includes(e)) throw c(o, \"Unexpected permission name.\");\n            var t = l();\n            return !!(null == t ? void 0 : t.scope.includes(e));\n          }(r) ? (e = h()) ? [4, v(e)] : [3, 2] : [2, {\n            state: \"unavailable\"\n          }];\n\n        case 1:\n          a = t.sent(), u = unescape(a.scope).split(\" \");\n\n          try {\n            for (f = n(u), p = f.next(); !p.done; p = f.next()) if (p.value.includes(r)) return [2, {\n              state: \"granted\"\n            }];\n          } catch (w) {\n            d = {\n              error: w\n            };\n          } finally {\n            try {\n              p && !p.done && (m = f.return) && m.call(f);\n            } finally {\n              if (d) throw d.error;\n            }\n          }\n\n          return [2, {\n            state: \"prompt\"\n          }];\n\n        case 2:\n          throw c(s, \"LiffId is not found.\");\n      }\n    });\n  });\n}\n\nfunction k() {\n  var e,\n      t,\n      n = l();\n  return !!n && \"square_chat\" !== n.type && (g(\"skipChannelVerificationScreen\") || !b() && (null === (t = null === (e = n.availability) || void 0 === e ? void 0 : e.skipChannelVerificationScreen) || void 0 === t ? void 0 : t.permission));\n}\n\nfunction I() {\n  var e = p().liffId;\n  if (e) return m(w(\"unauthorizedPermissions\") + \"?liffId=\" + e, {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Accept: \"application/json\",\n      Authorization: \"Bearer \" + h()\n    }\n  });\n  throw c(s, \"liffId is required\");\n}\n\nvar j,\n    A = y.on,\n    S = y.off,\n    T = y.open,\n    q = function () {\n  function n(n, r) {\n    var i = this;\n    this.onSubmit = function (n) {\n      var r = n.newAccessToken,\n          o = n.error;\n      return e(i, void 0, void 0, function () {\n        return t(this, function (e) {\n          return r ? this.resolve({\n            newAccessToken: r\n          }) : o && this.reject(c(u, o)), this.teardown(), [2];\n        });\n      });\n    }, this.onClose = function () {\n      return e(i, void 0, void 0, function () {\n        return t(this, function (e) {\n          return this.reject(c(s, \"user didn't allow the agreement\")), this.teardown(), [2];\n        });\n      });\n    }, this.onCancel = function () {\n      return e(i, void 0, void 0, function () {\n        return t(this, function (e) {\n          return this.reject(c(s, \"user didn't allow the agreement\")), this.teardown(), [2];\n        });\n      });\n    }, this.onError = function (n) {\n      return e(i, void 0, void 0, function () {\n        return t(this, function (e) {\n          return this.reject(n), this.teardown(), [2];\n        });\n      });\n    }, this.resolve = n, this.reject = r, this.setup();\n  }\n\n  return n.prototype.setup = function () {\n    A(\"submit\", this.onSubmit), A(\"close\", this.onClose), A(\"cancel\", this.onCancel), A(\"error\", this.onError);\n  }, n.prototype.teardown = function () {\n    S(\"submit\", this.onSubmit), S(\"close\", this.onClose), S(\"cancel\", this.onCancel), S(\"error\", this.onError), j = void 0;\n  }, n.prototype.open = function () {\n    var e = p().liffId;\n    e ? T({\n      url: \"https://liff.line.me/1656032314-Xgrw5Pmk\",\n      appData: {\n        liffId: e,\n        channelId: f(e),\n        accessToken: h()\n      }\n    }) : this.reject(c(s, \"liffId is required\"));\n  }, n;\n}();\n\nfunction x() {\n  return e(this, void 0, void 0, function () {\n    var e, n;\n    return t(this, function (t) {\n      switch (t.label) {\n        case 0:\n          if (!k()) throw c(a, \"SkipChannelVerificationScreen is unavailable.\");\n          return j && j.teardown(), [4, I()];\n\n        case 1:\n          return e = t.sent(), (b() ? e : e.filter(function (e) {\n            return \"chat_message.write\" !== e;\n          })).length > 0 ? [4, new Promise(function (e, t) {\n            (j = new q(e, t)).open();\n          })] : [3, 3];\n\n        case 2:\n          return n = t.sent().newAccessToken, d(n), [3, 4];\n\n        case 3:\n          throw c(a, \"All permissions have already been approved.\");\n\n        case 4:\n          return [2];\n      }\n    });\n  });\n}\n\nfunction P(n, i) {\n  var o = this;\n  return function () {\n    for (var s = [], u = 0; u < arguments.length; u++) s[u] = arguments[u];\n\n    return e(o, void 0, void 0, function () {\n      var e, o, u;\n      return t(this, function (t) {\n        switch (t.label) {\n          case 0:\n            return e = (s.length > 0 ? s[s.length - 1] : {}).ignorePermissionCheck, o = void 0 !== e && e, [4, C(i)];\n\n          case 1:\n            if (\"unavailable\" !== (u = t.sent().state)) return [3, 2];\n            throw c(a, \"The permission is not in LIFF app scope.\");\n\n          case 2:\n            return \"prompt\" !== u || !k() || o || !b() && \"chat_message.write\" === i ? [3, 4] : [4, x()];\n\n          case 3:\n            return t.sent(), [3, 5];\n\n          case 4:\n            o && s.pop(), t.label = 5;\n\n          case 5:\n            return [4, n.apply(void 0, r(s))];\n\n          case 6:\n            return [2, t.sent()];\n        }\n      });\n    });\n  };\n}\n\nvar E = function () {\n  function e() {\n    this.name = \"permission\";\n  }\n\n  return e.prototype.install = function () {\n    return {\n      query: C,\n      requestAll: x\n    };\n  }, e;\n}(),\n    V = new E();\n\nexport { E as PermissionModule, P as attachChecker, V as module };","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/@liff/permission/lib/index.es.js"],"names":["__awaiter","e","__generator","t","__values","n","__spread","r","PERMISSION_NAMES","i","INVALID_ARGUMENT","o","UNAUTHORIZED","s","FORBIDDEN","a","UNKNOWN","u","createLiffError","c","extractChannelIdFromLiffId","f","getContext","l","getAccessToken","h","getConfig","p","setAccessToken","d","verifyAccessToken","v","fetch","m","getEndPoint","w","isInClient","b","subWindow","y","isApiAvailable","g","C","label","includes","scope","state","sent","unescape","split","next","done","value","error","return","call","k","type","availability","skipChannelVerificationScreen","permission","I","liffId","headers","Accept","Authorization","j","A","on","S","off","T","open","q","onSubmit","newAccessToken","resolve","reject","teardown","onClose","onCancel","onError","setup","prototype","url","appData","channelId","accessToken","x","filter","length","Promise","P","arguments","ignorePermissionCheck","pop","apply","E","name","install","query","requestAll","V","PermissionModule","attachChecker","module"],"mappings":"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","sourcesContent":["import{__awaiter as e,__generator as t,__values as n,__spread as r}from\"tslib\";import{PERMISSION_NAMES as i,INVALID_ARGUMENT as o,UNAUTHORIZED as s,FORBIDDEN as a,UNKNOWN as u}from\"@liff/consts\";import{createLiffError as c,extractChannelIdFromLiffId as f}from\"@liff/util\";import{getContext as l,getAccessToken as h,getConfig as p,setAccessToken as d}from\"@liff/store\";import{verifyAccessToken as v,fetch as m,getEndPoint as w}from\"@liff/server-api\";import{isInClient as b}from\"@liff/is-in-client\";import{subWindow as y}from\"@liff/sub-window\";import{isApiAvailable as g}from\"@liff/is-api-available\";function C(r){return e(this,void 0,void 0,(function(){var e,a,u,f,p,d,m;return t(this,(function(t){switch(t.label){case 0:return function(e){if(!i.includes(e))throw c(o,\"Unexpected permission name.\");var t=l();return!!(null==t?void 0:t.scope.includes(e))}(r)?(e=h())?[4,v(e)]:[3,2]:[2,{state:\"unavailable\"}];case 1:a=t.sent(),u=unescape(a.scope).split(\" \");try{for(f=n(u),p=f.next();!p.done;p=f.next())if(p.value.includes(r))return[2,{state:\"granted\"}]}catch(w){d={error:w}}finally{try{p&&!p.done&&(m=f.return)&&m.call(f)}finally{if(d)throw d.error}}return[2,{state:\"prompt\"}];case 2:throw c(s,\"LiffId is not found.\")}}))}))}function k(){var e,t,n=l();return!!n&&(\"square_chat\"!==n.type&&(g(\"skipChannelVerificationScreen\")||!b()&&(null===(t=null===(e=n.availability)||void 0===e?void 0:e.skipChannelVerificationScreen)||void 0===t?void 0:t.permission)))}function I(){var e=p().liffId;if(e)return m(w(\"unauthorizedPermissions\")+\"?liffId=\"+e,{headers:{\"Content-Type\":\"application/json\",Accept:\"application/json\",Authorization:\"Bearer \"+h()}});throw c(s,\"liffId is required\")}var j,A=y.on,S=y.off,T=y.open,q=function(){function n(n,r){var i=this;this.onSubmit=function(n){var r=n.newAccessToken,o=n.error;return e(i,void 0,void 0,(function(){return t(this,(function(e){return r?this.resolve({newAccessToken:r}):o&&this.reject(c(u,o)),this.teardown(),[2]}))}))},this.onClose=function(){return e(i,void 0,void 0,(function(){return t(this,(function(e){return this.reject(c(s,\"user didn't allow the agreement\")),this.teardown(),[2]}))}))},this.onCancel=function(){return e(i,void 0,void 0,(function(){return t(this,(function(e){return this.reject(c(s,\"user didn't allow the agreement\")),this.teardown(),[2]}))}))},this.onError=function(n){return e(i,void 0,void 0,(function(){return t(this,(function(e){return this.reject(n),this.teardown(),[2]}))}))},this.resolve=n,this.reject=r,this.setup()}return n.prototype.setup=function(){A(\"submit\",this.onSubmit),A(\"close\",this.onClose),A(\"cancel\",this.onCancel),A(\"error\",this.onError)},n.prototype.teardown=function(){S(\"submit\",this.onSubmit),S(\"close\",this.onClose),S(\"cancel\",this.onCancel),S(\"error\",this.onError),j=void 0},n.prototype.open=function(){var e=p().liffId;e?T({url:\"https://liff.line.me/1656032314-Xgrw5Pmk\",appData:{liffId:e,channelId:f(e),accessToken:h()}}):this.reject(c(s,\"liffId is required\"))},n}();function x(){return e(this,void 0,void 0,(function(){var e,n;return t(this,(function(t){switch(t.label){case 0:if(!k())throw c(a,\"SkipChannelVerificationScreen is unavailable.\");return j&&j.teardown(),[4,I()];case 1:return e=t.sent(),(b()?e:e.filter((function(e){return\"chat_message.write\"!==e}))).length>0?[4,new Promise((function(e,t){(j=new q(e,t)).open()}))]:[3,3];case 2:return n=t.sent().newAccessToken,d(n),[3,4];case 3:throw c(a,\"All permissions have already been approved.\");case 4:return[2]}}))}))}function P(n,i){var o=this;return function(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return e(o,void 0,void 0,(function(){var e,o,u;return t(this,(function(t){switch(t.label){case 0:return e=(s.length>0?s[s.length-1]:{}).ignorePermissionCheck,o=void 0!==e&&e,[4,C(i)];case 1:if(\"unavailable\"!==(u=t.sent().state))return[3,2];throw c(a,\"The permission is not in LIFF app scope.\");case 2:return\"prompt\"!==u||!k()||o||!b()&&\"chat_message.write\"===i?[3,4]:[4,x()];case 3:return t.sent(),[3,5];case 4:o&&s.pop(),t.label=5;case 5:return[4,n.apply(void 0,r(s))];case 6:return[2,t.sent()]}}))}))}}var E=function(){function e(){this.name=\"permission\"}return e.prototype.install=function(){return{query:C,requestAll:x}},e}(),V=new E;export{E as PermissionModule,P as attachChecker,V as module};\n"]},"metadata":{},"sourceType":"module"}