{"ast":null,"code":"var _jsxFileName = \"/home/vuxuantu/Desktop/rewarding-platform-client/src/Modules/authentication/FaceBook.tsx\",\n    _s = $RefreshSig$();\n\nimport { memo, useCallback } from \"react\";\nimport FacebookLogin from \"react-facebook-login\";\nimport axios from \"axios\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { unwrapResult } from \"@reduxjs/toolkit\";\nimport { enumExternalAuthType, enumExternalMethod, FACEBOOK_GRAPH_URL } from \"@configs\";\nimport { fbLogin, fbSignup, logout, openToast, setExternalLogin } from \"@redux\";\nimport { ComponentFaceBookButton } from \"@components\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const ModuleFaceBook = /*#__PURE__*/memo(_c = _s(props => {\n  _s();\n\n  //hooks\n  const dispatch = useDispatch();\n  const {\n    t\n  } = useTranslation(); //page variable\n\n  const scope = \"name,email,picture\";\n  const handleFBLogin = useCallback(() => {\n    dispatch(setExternalLogin({\n      type: enumExternalMethod.FACEBOOK\n    }));\n  }, []);\n\n  const responseFacebook = async response => {\n    if (response === null || response === void 0 ? void 0 : response.accessToken) {\n      const longLiveTokenUrl = `${FACEBOOK_GRAPH_URL}/access_token?grant_type=fb_exchange_token&client_id=${process.env.REACT_APP_FACEBOOK_ID}&client_secret=${process.env.REACT_APP_FACEBOOK_SECRET}&fb_exchange_token=${response === null || response === void 0 ? void 0 : response.accessToken}`;\n      const userId = response.userID;\n\n      try {\n        var _res$data;\n\n        const res = await axios.get(longLiveTokenUrl);\n\n        if (res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.access_token) {\n          var _response;\n\n          let response;\n\n          if (props.state.type === enumExternalAuthType.LOGIN) {\n            var _res$data2;\n\n            const fbLoginData = {\n              userId,\n              token: res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.access_token\n            };\n            response = await dispatch(fbLogin(fbLoginData)); //WHAT: wrap function in create async thunk\n            //@ts-ignore\n\n            unwrapResult(response);\n          } else if (props.state.type === enumExternalAuthType.SIGNUP) {\n            var _res$data3;\n\n            const fbSignupData = {\n              userId,\n              token: res === null || res === void 0 ? void 0 : (_res$data3 = res.data) === null || _res$data3 === void 0 ? void 0 : _res$data3.access_token,\n              inviteId: props.state.inviteId\n            };\n            response = await dispatch(fbSignup(fbSignupData)); //WHAT: wrap function in create async thunk\n            //@ts-ignore\n\n            unwrapResult(response);\n          } //@ts-ignore\n\n\n          if (!((_response = response) === null || _response === void 0 ? void 0 : _response.payload.accessToken)) {\n            dispatch(openToast({\n              message: t(\"page.auth.email_password_correct\"),\n              type: \"error\",\n              autoHideDuration: 2000\n            }));\n          } else {\n            dispatch(openToast({\n              message: t(\"page.auth.login_successfully\"),\n              type: \"success\",\n              autoHideDuration: 2000\n            }));\n          }\n        } else {\n          dispatch(logout());\n        }\n      } catch (error) {\n        props.errorHandler(error);\n      }\n    } else {\n      dispatch(logout());\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(FacebookLogin, {\n    appId: process.env.REACT_APP_FACEBOOK_ID,\n    autoLoad: false,\n    cssClass: \"fb-button\",\n    render: renderProps => /*#__PURE__*/_jsxDEV(ComponentFaceBookButton, {\n      onClick: renderProps.onClick\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 43\n    }, this),\n    fields: scope,\n    textButton: \"\",\n    onClick: handleFBLogin,\n    callback: responseFacebook,\n    icon: \"fa-facebook\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 9\n  }, this);\n}, \"zxxyyHBHrrekHVlnqaz3XRcpvxI=\", false, function () {\n  return [useDispatch, useTranslation];\n}));\n_c2 = ModuleFaceBook;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ModuleFaceBook$memo\");\n$RefreshReg$(_c2, \"ModuleFaceBook\");","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/src/Modules/authentication/FaceBook.tsx"],"names":["memo","useCallback","FacebookLogin","axios","useDispatch","useTranslation","unwrapResult","enumExternalAuthType","enumExternalMethod","FACEBOOK_GRAPH_URL","fbLogin","fbSignup","logout","openToast","setExternalLogin","ComponentFaceBookButton","ModuleFaceBook","props","dispatch","t","scope","handleFBLogin","type","FACEBOOK","responseFacebook","response","accessToken","longLiveTokenUrl","process","env","REACT_APP_FACEBOOK_ID","REACT_APP_FACEBOOK_SECRET","userId","userID","res","get","data","access_token","state","LOGIN","fbLoginData","token","SIGNUP","fbSignupData","inviteId","payload","message","autoHideDuration","error","errorHandler","renderProps","onClick"],"mappings":"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","sourcesContent":["import { memo, useCallback } from \"react\";\nimport FacebookLogin from \"react-facebook-login\";\nimport axios from \"axios\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { unwrapResult } from \"@reduxjs/toolkit\";\n\nimport { enumExternalAuthType, enumExternalMethod, FACEBOOK_GRAPH_URL } from \"@configs\";\nimport { IFBLogin, IExternalAuthState, IFBSignup } from \"@interfaces\";\nimport { fbLogin, fbSignup, logout, openToast, setExternalLogin } from \"@redux\";\nimport { ComponentFaceBookButton } from \"@components\";\n\ninterface IProps {\n    errorHandler: (error: any) => void;\n    state: IExternalAuthState;\n}\n\nexport const ModuleFaceBook = memo((props: IProps) => {\n    //hooks\n    const dispatch = useDispatch();\n    const { t } = useTranslation();\n    //page variable\n    const scope = \"name,email,picture\";\n\n    const handleFBLogin = useCallback(() => {\n        dispatch(setExternalLogin({ type: enumExternalMethod.FACEBOOK }));\n    }, []);\n\n    const responseFacebook = async (response: any) => {\n        if (response?.accessToken) {\n            const longLiveTokenUrl = `${FACEBOOK_GRAPH_URL}/access_token?grant_type=fb_exchange_token&client_id=${process.env.REACT_APP_FACEBOOK_ID}&client_secret=${process.env.REACT_APP_FACEBOOK_SECRET}&fb_exchange_token=${response?.accessToken}`;\n            const userId = response.userID;\n            try {\n                const res = await axios.get(longLiveTokenUrl);\n                if (res?.data?.access_token) {\n                    let response;\n                    if (props.state.type === enumExternalAuthType.LOGIN) {\n                        const fbLoginData: IFBLogin = {\n                            userId,\n                            token: res?.data?.access_token,\n                        };\n\n                        response = await dispatch(fbLogin(fbLoginData));\n                        //WHAT: wrap function in create async thunk\n                        //@ts-ignore\n                        unwrapResult(response);\n                    } else if (props.state.type === enumExternalAuthType.SIGNUP) {\n                        const fbSignupData: IFBSignup = {\n                            userId,\n                            token: res?.data?.access_token,\n                            inviteId: props.state.inviteId,\n                        };\n\n                        response = await dispatch(fbSignup(fbSignupData));\n                        //WHAT: wrap function in create async thunk\n                        //@ts-ignore\n                        unwrapResult(response);\n                    }\n\n                    //@ts-ignore\n                    if (!response?.payload.accessToken) {\n                        dispatch(\n                            openToast({\n                                message: t(\"page.auth.email_password_correct\"),\n                                type: \"error\",\n                                autoHideDuration: 2000,\n                            })\n                        );\n                    } else {\n                        dispatch(\n                            openToast({\n                                message: t(\"page.auth.login_successfully\"),\n                                type: \"success\",\n                                autoHideDuration: 2000,\n                            })\n                        );\n                    }\n                } else {\n                    dispatch(logout());\n                }\n            } catch (error) {\n                props.errorHandler(error);\n            }\n        } else {\n            dispatch(logout());\n        }\n    };\n\n    return (\n        <FacebookLogin\n            appId={process.env.REACT_APP_FACEBOOK_ID}\n            autoLoad={false}\n            cssClass=\"fb-button\"\n            render={(renderProps: any) => <ComponentFaceBookButton onClick={renderProps.onClick} />}\n            fields={scope}\n            textButton={\"\"}\n            onClick={handleFBLogin}\n            callback={responseFacebook}\n            icon=\"fa-facebook\"\n        />\n    );\n});\n"]},"metadata":{},"sourceType":"module"}