{"ast":null,"code":"import _regeneratorRuntime from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{memo,useCallback}from\"react\";import FacebookLogin from\"react-facebook-login\";import axios from\"axios\";import{useDispatch}from\"react-redux\";import{useTranslation}from\"react-i18next\";import{unwrapResult}from\"@reduxjs/toolkit\";import{enumExternalAuthType,enumExternalMethod,FACEBOOK_GRAPH_URL}from\"@configs\";import{fbLogin,fbSignup,logout,openToast,setExternalLogin}from\"@redux\";import{jsx as _jsx}from\"react/jsx-runtime\";export var ModuleFaceBook=/*#__PURE__*/memo(function(props){//hooks\nvar dispatch=useDispatch();var _useTranslation=useTranslation(),t=_useTranslation.t;//page variable\nvar scope=\"name,email,picture\";var handleFBLogin=useCallback(function(){dispatch(setExternalLogin({type:enumExternalMethod.FACEBOOK,isSignUp:props.state.type===enumExternalAuthType.SIGNUP?true:false}));},[]);var responseFacebook=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var longLiveTokenUrl,userId,_res$data,res,_response2,_response,_res$data2,fbLoginData,_res$data3,fbSignupData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(response===null||response===void 0?void 0:response.accessToken)){_context.next=34;break;}longLiveTokenUrl=\"\".concat(FACEBOOK_GRAPH_URL,\"/access_token?grant_type=fb_exchange_token&client_id=\").concat(process.env.REACT_APP_FACEBOOK_ID,\"&client_secret=\").concat(process.env.REACT_APP_FACEBOOK_SECRET,\"&fb_exchange_token=\").concat(response===null||response===void 0?void 0:response.accessToken);userId=response.userID;_context.prev=3;_context.next=6;return axios.get(longLiveTokenUrl);case 6:res=_context.sent;if(!(res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.access_token)){_context.next=26;break;}if(!(props.state.type===enumExternalAuthType.LOGIN)){_context.next=17;break;}fbLoginData={userId:userId,token:res===null||res===void 0?void 0:(_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.access_token};_context.next=12;return dispatch(fbLogin(fbLoginData));case 12:_response=_context.sent;dispatch(openToast({message:t(\"page.auth.login_successfully\"),type:\"success\",autoHideDuration:2000}));//WHAT: wrap function in create async thunk\n//@ts-ignore\nunwrapResult(_response);_context.next=23;break;case 17:if(!(props.state.type===enumExternalAuthType.SIGNUP)){_context.next=23;break;}fbSignupData={userId:userId,token:res===null||res===void 0?void 0:(_res$data3=res.data)===null||_res$data3===void 0?void 0:_res$data3.access_token};_context.next=21;return dispatch(fbSignup(fbSignupData));case 21:_response=_context.sent;//WHAT: wrap function in create async thunk\n//@ts-ignore\nunwrapResult(_response);case 23://@ts-ignore\nif(!((_response2=_response)===null||_response2===void 0?void 0:_response2.payload.accessToken)){dispatch(openToast({message:t(\"page.auth.email_password_correct\"),type:\"error\",autoHideDuration:2000}));}_context.next=27;break;case 26:dispatch(logout());case 27:_context.next=32;break;case 29:_context.prev=29;_context.t0=_context[\"catch\"](3);props.errorHandler(_context.t0);case 32:_context.next=35;break;case 34:dispatch(logout());case 35:case\"end\":return _context.stop();}}},_callee,null,[[3,29]]);}));return function responseFacebook(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(FacebookLogin,{appId:process.env.REACT_APP_FACEBOOK_ID||\"\",autoLoad:false,cssClass:\"fb-button\",fields:scope,textButton:\"\",onClick:handleFBLogin,callback:responseFacebook,icon:\"fa-facebook\"});});","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/src/Modules/authentication/FaceBook.tsx"],"names":["memo","useCallback","FacebookLogin","axios","useDispatch","useTranslation","unwrapResult","enumExternalAuthType","enumExternalMethod","FACEBOOK_GRAPH_URL","fbLogin","fbSignup","logout","openToast","setExternalLogin","ModuleFaceBook","props","dispatch","t","scope","handleFBLogin","type","FACEBOOK","isSignUp","state","SIGNUP","responseFacebook","response","accessToken","longLiveTokenUrl","process","env","REACT_APP_FACEBOOK_ID","REACT_APP_FACEBOOK_SECRET","userId","userID","get","res","data","access_token","LOGIN","fbLoginData","token","message","autoHideDuration","fbSignupData","payload","errorHandler"],"mappings":"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","sourcesContent":["import { memo, useCallback } from \"react\";\nimport FacebookLogin from \"react-facebook-login\";\nimport axios from \"axios\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { unwrapResult } from \"@reduxjs/toolkit\";\n\nimport { enumExternalAuthType, enumExternalMethod, FACEBOOK_GRAPH_URL } from \"@configs\";\nimport { IFBLogin, IExternalAuthState, IFBSignup } from \"@interfaces\";\nimport { fbLogin, fbSignup, logout, openToast, setExternalLogin } from \"@redux\";\n\ninterface IProps {\n    errorHandler: (error: any) => void;\n    state: IExternalAuthState;\n}\n\nexport const ModuleFaceBook = memo((props: IProps) => {\n    //hooks\n    const dispatch = useDispatch();\n    const { t } = useTranslation();\n    //page variable\n    const scope = \"name,email,picture\";\n\n    const handleFBLogin = useCallback(() => {\n        dispatch(\n            setExternalLogin({\n                type: enumExternalMethod.FACEBOOK,\n                isSignUp: props.state.type === enumExternalAuthType.SIGNUP ? true : false,\n            })\n        );\n    }, []);\n\n    const responseFacebook = async (response: any) => {\n        if (response?.accessToken) {\n            const longLiveTokenUrl = `${FACEBOOK_GRAPH_URL}/access_token?grant_type=fb_exchange_token&client_id=${process.env.REACT_APP_FACEBOOK_ID}&client_secret=${process.env.REACT_APP_FACEBOOK_SECRET}&fb_exchange_token=${response?.accessToken}`;\n            const userId = response.userID;\n            try {\n                const res = await axios.get(longLiveTokenUrl);\n                if (res?.data?.access_token) {\n                    let response;\n                    if (props.state.type === enumExternalAuthType.LOGIN) {\n                        const fbLoginData: IFBLogin = {\n                            userId,\n                            token: res?.data?.access_token,\n                        };\n\n                        response = await dispatch(fbLogin(fbLoginData));\n\n                        dispatch(\n                            openToast({\n                                message: t(\"page.auth.login_successfully\"),\n                                type: \"success\",\n                                autoHideDuration: 2000,\n                            })\n                        );\n                        //WHAT: wrap function in create async thunk\n                        //@ts-ignore\n                        unwrapResult(response);\n                    } else if (props.state.type === enumExternalAuthType.SIGNUP) {\n                        const fbSignupData: IFBSignup = {\n                            userId,\n                            token: res?.data?.access_token,\n                        };\n                        response = await dispatch(fbSignup(fbSignupData));\n                        //WHAT: wrap function in create async thunk\n                        //@ts-ignore\n                        unwrapResult(response);\n                    }\n\n                    //@ts-ignore\n                    if (!response?.payload.accessToken) {\n                        dispatch(\n                            openToast({\n                                message: t(\"page.auth.email_password_correct\"),\n                                type: \"error\",\n                                autoHideDuration: 2000,\n                            })\n                        );\n                    }\n                } else {\n                    dispatch(logout());\n                }\n            } catch (error) {\n                props.errorHandler(error);\n            }\n        } else {\n            dispatch(logout());\n        }\n    };\n\n    return (\n        <FacebookLogin\n            appId={process.env.REACT_APP_FACEBOOK_ID || \"\"}\n            autoLoad={false}\n            cssClass=\"fb-button\"\n            fields={scope}\n            textButton={\"\"}\n            onClick={handleFBLogin}\n            callback={responseFacebook}\n            icon=\"fa-facebook\"\n        />\n    );\n});\n"]},"metadata":{},"sourceType":"module"}