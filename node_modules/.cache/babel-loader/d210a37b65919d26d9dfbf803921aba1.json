{"ast":null,"code":"import { __awaiter as t, __generator as e, __assign as i } from \"tslib\";\nimport { UTS_REFERRER_QUERY as s } from \"@liff/consts\";\nimport { logger as n } from \"@liff/logger\";\nimport { removeCredential as r, qs as o } from \"@liff/util\";\nimport { getDecodedIDToken as f, getContext as u, getConfig as a } from \"@liff/store\";\nimport { getVersion as c } from \"@liff/get-version\";\nimport { isLoggedIn as d } from \"@liff/is-logged-in\";\nimport { getProfile as l } from \"@liff/get-profile\";\n\nfunction p() {\n  return t(this, void 0, void 0, function () {\n    var t, i;\n    return e(this, function (e) {\n      switch (e.label) {\n        case 0:\n          if (!d()) return [3, 6];\n          e.label = 1;\n\n        case 1:\n          return e.trys.push([1, 5,, 6]), (t = f()) && t.sub ? [2, t.sub] : [3, 2];\n\n        case 2:\n          return [4, l()];\n\n        case 3:\n          if ((i = e.sent()) && i.userId) return [2, i.userId];\n          e.label = 4;\n\n        case 4:\n          return [3, 6];\n\n        case 5:\n          return e.sent(), n.debug(\"can't retrieve Mid/Uid because of something wrong\"), [3, 6];\n\n        case 6:\n          return [2];\n      }\n    });\n  });\n}\n\nfunction h() {\n  return t(this, void 0, void 0, function () {\n    var t;\n    return e(this, function (e) {\n      switch (e.label) {\n        case 0:\n          return [4, p()];\n\n        case 1:\n          return (t = e.sent()) && \"u\" === t.substring(0, 1) ? [2, t] : [2];\n      }\n    });\n  });\n}\n\nvar g = function () {\n  function f() {\n    this.utsExtra = {\n      isLiffSuccessful: !1,\n      isLoggedIn: !1,\n      id: \"\",\n      version: \"\"\n    }, this.injected = !1;\n  }\n\n  return Object.defineProperty(f, \"CUSTOMPLACEID_INIT\", {\n    get: function () {\n      return \"liff.init\";\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(f, \"CUSTOMTYPE\", {\n    get: function () {\n      return \"liffSdk\";\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(f, \"GENERAL_UTS_ID\", {\n    get: function () {\n      return \"liff_general\";\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(f, \"GENERAL_APP_NAME\", {\n    get: function () {\n      return \"LIFF General\";\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(f, \"LiffUtsLoginStatus\", {\n    get: function () {\n      return {\n        isLoggedIn: 1,\n        isLiffSuccessful: 2\n      };\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(f.prototype, \"name\", {\n    get: function () {\n      return \"analytics\";\n    },\n    enumerable: !1,\n    configurable: !0\n  }), f.prototype.install = function (t) {\n    var e = t.addHooks,\n        i = t.liff;\n    this.liffCore = i, e({\n      beforeInitFinished: this.beforeInitFinished.bind(this),\n      beforeInitSuccess: this.beforeInitSuccess.bind(this),\n      initError: this.initError.bind(this)\n    });\n  }, f.prototype.changeRatioToUTSFormat = function (t) {\n    if (t && Number.isFinite(t)) return Math.round(100 * t);\n  }, f.prototype.setExtra = function () {\n    var t = this.utsExtra,\n        e = t.isLiffSuccessful,\n        i = t.isLoggedIn,\n        s = t.id,\n        n = t.version,\n        r = (i ? f.LiffUtsLoginStatus.isLoggedIn : 0) | (e ? f.LiffUtsLoginStatus.isLiffSuccessful : 0);\n    this.uts.setExtra(\"liff\", {\n      id: s,\n      loginStatus: r,\n      version: n\n    });\n  }, f.prototype.assignUtsExtra = function (t) {\n    Object.assign(this.utsExtra, t);\n  }, f.prototype.setVersion = function (t) {\n    this.assignUtsExtra({\n      version: t\n    }), n.debug(\"[LIFFUTS][SDK version] \" + t), this.setExtra();\n  }, f.prototype.setLiffId = function (t) {\n    this.assignUtsExtra({\n      id: t\n    }), n.debug(\"[LIFFUTS][LIFFID] \" + t), this.setExtra();\n  }, f.prototype.setIsLoggedIn = function (t) {\n    this.assignUtsExtra({\n      isLoggedIn: t\n    }), n.debug(\"[LIFFUTS][isLoggedIn] \" + t), this.setExtra();\n  }, f.prototype.sendLiffInit = function () {\n    n.debug(\"[LIFFUTS][sendCustom] liff.init\"), this.uts.sendCustom({\n      type: f.CUSTOMTYPE,\n      params: {\n        placeId: f.CUSTOMPLACEID_INIT\n      }\n    });\n  }, f.prototype.setIsLiffSuccessful = function (t) {\n    this.assignUtsExtra({\n      isLiffSuccessful: t\n    }), n.debug(\"[LIFFUTS][isLiffInitSuccessful] \" + t), this.setExtra();\n  }, f.prototype.prepareReferrer = function (t) {\n    var e = {};\n    Object.keys(t).forEach(function (i) {\n      if (s.includes(i)) {\n        var n = t[i];\n        \"string\" == typeof n && n && (e[i.replace(/^liff\\.ref\\./, \"\")] = n);\n      }\n    }), Object.keys(e).length > 0 && (this.referrer = e);\n  }, f.prototype.beforeInitFinished = function () {\n    return t(this, void 0, void 0, function () {\n      var t, s, l, p, g, b, I, m, L, S, E, v, T;\n      return e(this, function (e) {\n        switch (e.label) {\n          case 0:\n            if (t = o.parse(window.location.search), this.prepareReferrer(t), s = u(), !(l = null == s ? void 0 : s.utsTracking)) return [2];\n            if (\"auto\" !== (p = l.mode) && \"force\" !== p) return [3, 6];\n            n.debug(\"[LIFFUTS] \" + new Date().toUTCString()), g = a(), b = g.liffId, I = g.analytics, e.label = 1;\n\n          case 1:\n            return e.trys.push([1, 3,, 4]), m = this, [4, new Promise(function (t, e) {\n              var i = window.uts,\n                  s = document.createElement(\"script\");\n              s.type = \"text/javascript\", s.src = \"https://static.line-scdn.net/uts/edge/4.1.0/uts.js\", s.onload = function () {\n                var e = window.uts;\n                t(e), window.uts = i;\n              }, s.onerror = function (t) {\n                e(t);\n              }, document.getElementsByTagName(\"head\")[0].appendChild(s);\n            })];\n\n          case 2:\n            return m.uts = e.sent(), [3, 4];\n\n          case 3:\n            return L = e.sent(), n.debug(\"[LIFFUTS] cannot load UTS, reason: \" + L), [2];\n\n          case 4:\n            return S = void 0, E = void 0, \"force\" === p ? (S = {\n              utsId: f.GENERAL_UTS_ID,\n              appName: f.GENERAL_APP_NAME,\n              appEnv: \"release\"\n            }, E = {\n              endpoint: \"https://uts-front.line-apps.com\",\n              sampleRate: this.changeRatioToUTSFormat(l.sendRatio),\n              version: \"current\"\n            }) : (S = i(i({}, null == I ? void 0 : I.context), {\n              utsId: (null == I ? void 0 : I.context.utsId) || f.GENERAL_UTS_ID,\n              appName: (null == I ? void 0 : I.context.appName) || f.GENERAL_APP_NAME,\n              appEnv: (null == I ? void 0 : I.context.appEnv) || \"release\"\n            }), E = i(i({\n              endpoint: \"https://uts-front.line-apps.com\"\n            }, null == I ? void 0 : I.options), {\n              sampleRate: this.changeRatioToUTSFormat(l.sendRatio),\n              version: \"current\"\n            })), this.uts.init(S, E), [4, h()];\n\n          case 5:\n            (v = e.sent()) && (n.debug(\"[LIFFUTS][mid] \" + v), this.uts.setMid(v)), (null == s ? void 0 : s.tid) && (n.debug(\"[LIFFUTS][tid] \" + s.tid), this.uts.setTid(s.tid)), this.referrer && (n.debug(\"liff.ref.referrer\", this.referrer), this.uts.setSessionParams(this.referrer)), b && this.setLiffId(b), this.setIsLoggedIn(d()), this.setVersion(c()), T = r(location.href), n.debug(\"[LIFFUTS][url] \" + T), this.uts.setUrl(T), this.liffCore.analytics = this.uts, this.injected = !0, e.label = 6;\n\n          case 6:\n            return [2];\n        }\n      });\n    });\n  }, f.prototype.beforeInitSuccess = function () {\n    this.injected && (this.setIsLiffSuccessful(!0), this.sendLiffInit());\n  }, f.prototype.initError = function () {\n    this.injected && (this.setIsLiffSuccessful(!1), this.sendLiffInit());\n  }, f;\n}(),\n    b = function (t) {\n  n.debug(\"[LIFFUTS][sendCustom] liff.shareTargetPicker\"), t.sendCustom({\n    type: \"liffSdk\",\n    params: {\n      placeId: \"liff.shareTargetPicker\"\n    }\n  });\n};\n\nexport { g as AnalyticsModule, b as sendShareTargetPicker };","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/@liff/analytics/lib/index.es.js"],"names":["__awaiter","t","__generator","e","__assign","i","UTS_REFERRER_QUERY","s","logger","n","removeCredential","r","qs","o","getDecodedIDToken","f","getContext","u","getConfig","a","getVersion","c","isLoggedIn","d","getProfile","l","p","label","trys","push","sub","sent","userId","debug","h","substring","g","utsExtra","isLiffSuccessful","id","version","injected","Object","defineProperty","get","enumerable","configurable","prototype","install","addHooks","liff","liffCore","beforeInitFinished","bind","beforeInitSuccess","initError","changeRatioToUTSFormat","Number","isFinite","Math","round","setExtra","LiffUtsLoginStatus","uts","loginStatus","assignUtsExtra","assign","setVersion","setLiffId","setIsLoggedIn","sendLiffInit","sendCustom","type","CUSTOMTYPE","params","placeId","CUSTOMPLACEID_INIT","setIsLiffSuccessful","prepareReferrer","keys","forEach","includes","replace","length","referrer","b","I","m","L","S","E","v","T","parse","window","location","search","utsTracking","mode","Date","toUTCString","liffId","analytics","Promise","document","createElement","src","onload","onerror","getElementsByTagName","appendChild","utsId","GENERAL_UTS_ID","appName","GENERAL_APP_NAME","appEnv","endpoint","sampleRate","sendRatio","context","options","init","setMid","tid","setTid","setSessionParams","href","setUrl","AnalyticsModule","sendShareTargetPicker"],"mappings":"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","sourcesContent":["import{__awaiter as t,__generator as e,__assign as i}from\"tslib\";import{UTS_REFERRER_QUERY as s}from\"@liff/consts\";import{logger as n}from\"@liff/logger\";import{removeCredential as r,qs as o}from\"@liff/util\";import{getDecodedIDToken as f,getContext as u,getConfig as a}from\"@liff/store\";import{getVersion as c}from\"@liff/get-version\";import{isLoggedIn as d}from\"@liff/is-logged-in\";import{getProfile as l}from\"@liff/get-profile\";function p(){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:if(!d())return[3,6];e.label=1;case 1:return e.trys.push([1,5,,6]),(t=f())&&t.sub?[2,t.sub]:[3,2];case 2:return[4,l()];case 3:if((i=e.sent())&&i.userId)return[2,i.userId];e.label=4;case 4:return[3,6];case 5:return e.sent(),n.debug(\"can't retrieve Mid/Uid because of something wrong\"),[3,6];case 6:return[2]}}))}))}function h(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,p()];case 1:return(t=e.sent())&&\"u\"===t.substring(0,1)?[2,t]:[2]}}))}))}var g=function(){function f(){this.utsExtra={isLiffSuccessful:!1,isLoggedIn:!1,id:\"\",version:\"\"},this.injected=!1}return Object.defineProperty(f,\"CUSTOMPLACEID_INIT\",{get:function(){return\"liff.init\"},enumerable:!1,configurable:!0}),Object.defineProperty(f,\"CUSTOMTYPE\",{get:function(){return\"liffSdk\"},enumerable:!1,configurable:!0}),Object.defineProperty(f,\"GENERAL_UTS_ID\",{get:function(){return\"liff_general\"},enumerable:!1,configurable:!0}),Object.defineProperty(f,\"GENERAL_APP_NAME\",{get:function(){return\"LIFF General\"},enumerable:!1,configurable:!0}),Object.defineProperty(f,\"LiffUtsLoginStatus\",{get:function(){return{isLoggedIn:1,isLiffSuccessful:2}},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,\"name\",{get:function(){return\"analytics\"},enumerable:!1,configurable:!0}),f.prototype.install=function(t){var e=t.addHooks,i=t.liff;this.liffCore=i,e({beforeInitFinished:this.beforeInitFinished.bind(this),beforeInitSuccess:this.beforeInitSuccess.bind(this),initError:this.initError.bind(this)})},f.prototype.changeRatioToUTSFormat=function(t){if(t&&Number.isFinite(t))return Math.round(100*t)},f.prototype.setExtra=function(){var t=this.utsExtra,e=t.isLiffSuccessful,i=t.isLoggedIn,s=t.id,n=t.version,r=(i?f.LiffUtsLoginStatus.isLoggedIn:0)|(e?f.LiffUtsLoginStatus.isLiffSuccessful:0);this.uts.setExtra(\"liff\",{id:s,loginStatus:r,version:n})},f.prototype.assignUtsExtra=function(t){Object.assign(this.utsExtra,t)},f.prototype.setVersion=function(t){this.assignUtsExtra({version:t}),n.debug(\"[LIFFUTS][SDK version] \"+t),this.setExtra()},f.prototype.setLiffId=function(t){this.assignUtsExtra({id:t}),n.debug(\"[LIFFUTS][LIFFID] \"+t),this.setExtra()},f.prototype.setIsLoggedIn=function(t){this.assignUtsExtra({isLoggedIn:t}),n.debug(\"[LIFFUTS][isLoggedIn] \"+t),this.setExtra()},f.prototype.sendLiffInit=function(){n.debug(\"[LIFFUTS][sendCustom] liff.init\"),this.uts.sendCustom({type:f.CUSTOMTYPE,params:{placeId:f.CUSTOMPLACEID_INIT}})},f.prototype.setIsLiffSuccessful=function(t){this.assignUtsExtra({isLiffSuccessful:t}),n.debug(\"[LIFFUTS][isLiffInitSuccessful] \"+t),this.setExtra()},f.prototype.prepareReferrer=function(t){var e={};Object.keys(t).forEach((function(i){if(s.includes(i)){var n=t[i];\"string\"==typeof n&&n&&(e[i.replace(/^liff\\.ref\\./,\"\")]=n)}})),Object.keys(e).length>0&&(this.referrer=e)},f.prototype.beforeInitFinished=function(){return t(this,void 0,void 0,(function(){var t,s,l,p,g,b,I,m,L,S,E,v,T;return e(this,(function(e){switch(e.label){case 0:if(t=o.parse(window.location.search),this.prepareReferrer(t),s=u(),!(l=null==s?void 0:s.utsTracking))return[2];if(\"auto\"!==(p=l.mode)&&\"force\"!==p)return[3,6];n.debug(\"[LIFFUTS] \"+(new Date).toUTCString()),g=a(),b=g.liffId,I=g.analytics,e.label=1;case 1:return e.trys.push([1,3,,4]),m=this,[4,new Promise((function(t,e){var i=window.uts,s=document.createElement(\"script\");s.type=\"text/javascript\",s.src=\"https://static.line-scdn.net/uts/edge/4.1.0/uts.js\",s.onload=function(){var e=window.uts;t(e),window.uts=i},s.onerror=function(t){e(t)},document.getElementsByTagName(\"head\")[0].appendChild(s)}))];case 2:return m.uts=e.sent(),[3,4];case 3:return L=e.sent(),n.debug(\"[LIFFUTS] cannot load UTS, reason: \"+L),[2];case 4:return S=void 0,E=void 0,\"force\"===p?(S={utsId:f.GENERAL_UTS_ID,appName:f.GENERAL_APP_NAME,appEnv:\"release\"},E={endpoint:\"https://uts-front.line-apps.com\",sampleRate:this.changeRatioToUTSFormat(l.sendRatio),version:\"current\"}):(S=i(i({},null==I?void 0:I.context),{utsId:(null==I?void 0:I.context.utsId)||f.GENERAL_UTS_ID,appName:(null==I?void 0:I.context.appName)||f.GENERAL_APP_NAME,appEnv:(null==I?void 0:I.context.appEnv)||\"release\"}),E=i(i({endpoint:\"https://uts-front.line-apps.com\"},null==I?void 0:I.options),{sampleRate:this.changeRatioToUTSFormat(l.sendRatio),version:\"current\"})),this.uts.init(S,E),[4,h()];case 5:(v=e.sent())&&(n.debug(\"[LIFFUTS][mid] \"+v),this.uts.setMid(v)),(null==s?void 0:s.tid)&&(n.debug(\"[LIFFUTS][tid] \"+s.tid),this.uts.setTid(s.tid)),this.referrer&&(n.debug(\"liff.ref.referrer\",this.referrer),this.uts.setSessionParams(this.referrer)),b&&this.setLiffId(b),this.setIsLoggedIn(d()),this.setVersion(c()),T=r(location.href),n.debug(\"[LIFFUTS][url] \"+T),this.uts.setUrl(T),this.liffCore.analytics=this.uts,this.injected=!0,e.label=6;case 6:return[2]}}))}))},f.prototype.beforeInitSuccess=function(){this.injected&&(this.setIsLiffSuccessful(!0),this.sendLiffInit())},f.prototype.initError=function(){this.injected&&(this.setIsLiffSuccessful(!1),this.sendLiffInit())},f}(),b=function(t){n.debug(\"[LIFFUTS][sendCustom] liff.shareTargetPicker\"),t.sendCustom({type:\"liffSdk\",params:{placeId:\"liff.shareTargetPicker\"}})};export{g as AnalyticsModule,b as sendShareTargetPicker};\n"]},"metadata":{},"sourceType":"module"}