{"ast":null,"code":"import _regeneratorRuntime from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/vuxuantu/Desktop/rewarding-platform-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useHistory,useParams}from\"react-router\";import{useTranslation}from\"react-i18next\";import{couponApi,merchantApi}from\"@api\";import{ComponentCouponDetail,ComponentPopUpConfirm}from\"@components\";import{PATH_404,enumStatus,enumTypes,PATH_HOME,PATH_SIGN_IN}from\"@configs\";import{selectAuth,setExternalTypes,setLoading,setMainColor,setMerchant,setMerchantID}from\"@redux\";import{useNotify}from\"@utils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var PageCoupon=function PageCoupon(){//page hook\nvar _useTranslation=useTranslation(),t=_useTranslation.t;var dispatch=useDispatch();var _useParams=useParams(),id=_useParams.id,idParent=_useParams.idParent;var history=useHistory();var _useNotify=useNotify(),error=_useNotify.error,success=_useNotify.success;//page redux\nvar _useSelector=useSelector(selectAuth),auth=_useSelector.auth,externalType=_useSelector.externalType;//page state\nvar _useState=useState(),_useState2=_slicedToArray(_useState,2),coupon=_useState2[0],setCoupon=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showConfirm=_useState4[0],setShowConfirm=_useState4[1];//page variable\nvar token=auth===null||auth===void 0?void 0:auth.accessToken;useEffect(function(){useCoupon();},[]);var useCoupon=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data,_res,_data,merchantConfig,merchant;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch(setLoading(true));if(!id){_context.next=27;break;}if(!token){_context.next=12;break;}_context.next=6;return couponApi.getPreviewCoupon(id);case 6:res=_context.sent;data=res.data;setCoupon(data);dispatch(setExternalTypes({type:(externalType===null||externalType===void 0?void 0:externalType.type)||enumTypes.COUPON,id:\"\"}));_context.next=25;break;case 12:_context.next=14;return merchantApi.getCouponId(id);case 14:_res=_context.sent;_data=_res.data;dispatch(setMerchantID(_data.merchantId));_context.next=19;return merchantApi.getMerchantConfig();case 19:merchantConfig=_context.sent;merchant=merchantConfig.data.merchant;dispatch(setMerchant(merchant));dispatch(setMainColor(merchant.themeColor));dispatch(setExternalTypes({type:enumTypes.COUPON,id:id}));history.push(PATH_SIGN_IN);case 25:_context.next=28;break;case 27:history.push(PATH_404);case 28:_context.next=33;break;case 30:_context.prev=30;_context.t0=_context[\"catch\"](0);history.push(PATH_404);case 33:_context.prev=33;dispatch(setLoading(false));return _context.finish(33);case 36:case\"end\":return _context.stop();}}},_callee,null,[[0,30,33,36]]);}));return function useCoupon(){return _ref.apply(this,arguments);};}();var handleReceiveCoupon=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch(setLoading(true));_context2.next=4;return couponApi.receiveCoupon({objectId:(coupon===null||coupon===void 0?void 0:coupon._id)||\"\",status:enumStatus.ACTIVE,type:enumTypes.COUPON});case 4:res=_context2.sent;if(res.data.message){success(res.data.message);}_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);message=_context2.t0.response.data.message;if(message){error(message);}else{error(t(\"message.received.fail\"));}case 12:_context2.prev=12;dispatch(setLoading(false));history.push(PATH_HOME);return _context2.finish(12);case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8,12,16]]);}));return function handleReceiveCoupon(){return _ref2.apply(this,arguments);};}();var handleRedeemedCoupon=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res,_res2,message;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;if(!idParent){_context3.next=9;break;}dispatch(setLoading(true));_context3.next=5;return couponApi.redeemedCoupon({objectId:(coupon===null||coupon===void 0?void 0:coupon._id)||\"\",status:enumStatus.ACTIVE,type:enumTypes.COUPON,id:idParent});case 5:res=_context3.sent;if(res.data.message){success(res.data.message);}_context3.next=14;break;case 9:dispatch(setLoading(true));_context3.next=12;return couponApi.redeemedCouponNotId({objectId:(coupon===null||coupon===void 0?void 0:coupon._id)||\"\",status:enumStatus.ACTIVE,type:enumTypes.COUPON},id||\"\");case 12:_res2=_context3.sent;if(_res2.data.message){success(_res2.data.message);}case 14:_context3.next=20;break;case 16:_context3.prev=16;_context3.t0=_context3[\"catch\"](0);message=_context3.t0.response.data.message;if(message){error(message);}else{error(t(\"message.received.fail\"));}case 20:_context3.prev=20;dispatch(setLoading(false));history.push(PATH_HOME);return _context3.finish(20);case 24:case\"end\":return _context3.stop();}}},_callee3,null,[[0,16,20,24]]);}));return function handleRedeemedCoupon(){return _ref3.apply(this,arguments);};}();var handleToggleConfirm=function handleToggleConfirm(){setShowConfirm(!showConfirm);};return/*#__PURE__*/_jsxs(_Fragment,{children:[coupon&&/*#__PURE__*/_jsx(ComponentCouponDetail,{handleToggleConfirm:handleToggleConfirm,coupon:coupon,handleReceiveCoupon:handleReceiveCoupon}),showConfirm&&coupon&&/*#__PURE__*/_jsx(ComponentPopUpConfirm,{handleCloseDetail:handleToggleConfirm,data:coupon,handleConfirm:handleRedeemedCoupon})]});};","map":{"version":3,"sources":["/home/vuxuantu/Desktop/rewarding-platform-client/src/Pages/Coupon.tsx"],"names":["useEffect","useState","useDispatch","useSelector","useHistory","useParams","useTranslation","couponApi","merchantApi","ComponentCouponDetail","ComponentPopUpConfirm","PATH_404","enumStatus","enumTypes","PATH_HOME","PATH_SIGN_IN","selectAuth","setExternalTypes","setLoading","setMainColor","setMerchant","setMerchantID","useNotify","PageCoupon","t","dispatch","id","idParent","history","error","success","auth","externalType","coupon","setCoupon","showConfirm","setShowConfirm","token","accessToken","useCoupon","getPreviewCoupon","res","data","type","COUPON","getCouponId","merchantId","getMerchantConfig","merchantConfig","merchant","themeColor","push","handleReceiveCoupon","receiveCoupon","objectId","_id","status","ACTIVE","message","response","handleRedeemedCoupon","redeemedCoupon","redeemedCouponNotId","handleToggleConfirm"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useHistory, useParams } from \"react-router\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { couponApi, merchantApi } from \"@api\";\nimport { ComponentCouponDetail, ComponentPopUpConfirm } from \"@components\";\nimport { PATH_404, enumStatus, enumTypes, PATH_HOME, PATH_SIGN_IN } from \"@configs\";\nimport { ICoupon, IMerchant, IMerchantQRcode } from \"@interfaces\";\nimport {\n    selectAuth,\n    setExternalTypes,\n    setLoading,\n    setMainColor,\n    setMerchant,\n    setMerchantID,\n} from \"@redux\";\nimport { useNotify } from \"@utils\";\n\nexport const PageCoupon = () => {\n    //page hook\n    const { t } = useTranslation();\n    const dispatch = useDispatch();\n    const { id, idParent } = useParams<{ id: string; idParent: string }>();\n    const history = useHistory();\n    const { error, success } = useNotify();\n    //page redux\n    const { auth, externalType } = useSelector(selectAuth);\n    //page state\n    const [coupon, setCoupon] = useState<ICoupon>();\n    const [showConfirm, setShowConfirm] = useState<boolean>(false);\n    //page variable\n    const token = auth?.accessToken;\n\n    useEffect(() => {\n        useCoupon();\n    }, []);\n\n    const useCoupon = async () => {\n        try {\n            dispatch(setLoading(true));\n            if (id) {\n                if (token) {\n                    const res = await couponApi.getPreviewCoupon(id);\n                    const data = res.data as ICoupon;\n                    setCoupon(data);\n                    dispatch(\n                        setExternalTypes({ type: externalType?.type || enumTypes.COUPON, id: \"\" })\n                    );\n                } else {\n                    const res = await merchantApi.getCouponId(id);\n                    const data = res.data as IMerchantQRcode;\n                    dispatch(setMerchantID(data.merchantId));\n                    const merchantConfig = await merchantApi.getMerchantConfig();\n                    const merchant = merchantConfig.data.merchant as IMerchant;\n                    dispatch(setMerchant(merchant));\n                    dispatch(setMainColor(merchant.themeColor));\n                    dispatch(setExternalTypes({ type: enumTypes.COUPON, id }));\n                    history.push(PATH_SIGN_IN);\n                }\n            } else {\n                history.push(PATH_404);\n            }\n        } catch {\n            history.push(PATH_404);\n        } finally {\n            dispatch(setLoading(false));\n        }\n    };\n\n    const handleReceiveCoupon = async () => {\n        try {\n            dispatch(setLoading(true));\n            const res = await couponApi.receiveCoupon({\n                objectId: coupon?._id || \"\",\n                status: enumStatus.ACTIVE,\n                type: enumTypes.COUPON,\n            });\n            if (res.data.message) {\n                success(res.data.message);\n            }\n        } catch (err: any) {\n            const { message } = err.response.data;\n            if (message) {\n                error(message);\n            } else {\n                error(t(\"message.received.fail\"));\n            }\n        } finally {\n            dispatch(setLoading(false));\n            history.push(PATH_HOME);\n        }\n    };\n\n    const handleRedeemedCoupon = async () => {\n        try {\n            if (idParent) {\n                dispatch(setLoading(true));\n                const res = await couponApi.redeemedCoupon({\n                    objectId: coupon?._id || \"\",\n                    status: enumStatus.ACTIVE,\n                    type: enumTypes.COUPON,\n                    id: idParent,\n                });\n                if (res.data.message) {\n                    success(res.data.message);\n                }\n            } else {\n                dispatch(setLoading(true));\n                const res = await couponApi.redeemedCouponNotId(\n                    {\n                        objectId: coupon?._id || \"\",\n                        status: enumStatus.ACTIVE,\n                        type: enumTypes.COUPON,\n                    },\n                    id || \"\"\n                );\n                if (res.data.message) {\n                    success(res.data.message);\n                }\n            }\n        } catch (err: any) {\n            const { message } = err.response.data;\n            if (message) {\n                error(message);\n            } else {\n                error(t(\"message.received.fail\"));\n            }\n        } finally {\n            dispatch(setLoading(false));\n            history.push(PATH_HOME);\n        }\n    };\n\n    const handleToggleConfirm = () => {\n        setShowConfirm(!showConfirm);\n    };\n\n    return (\n        <>\n            {coupon && (\n                <ComponentCouponDetail\n                    handleToggleConfirm={handleToggleConfirm}\n                    coupon={coupon}\n                    handleReceiveCoupon={handleReceiveCoupon}\n                />\n            )}\n            {showConfirm && coupon && (\n                <ComponentPopUpConfirm\n                    handleCloseDetail={handleToggleConfirm}\n                    data={coupon as ICoupon}\n                    handleConfirm={handleRedeemedCoupon}\n                />\n            )}\n        </>\n    );\n};\n"]},"metadata":{},"sourceType":"module"}