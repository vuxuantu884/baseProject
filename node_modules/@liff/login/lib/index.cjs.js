"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@liff/consts"),r=require("@liff/logger"),i=require("@liff/util"),t=require("@liff/store"),o=require("@liff/server-api"),n=require("@liff/get-version"),f=require("@liff/is-sub-window"),l=require("@liff/is-in-client");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=u(require("tiny-sha256"));var a=function(){function u(e){this.driver=e}return Object.defineProperty(u.prototype,"name",{get:function(){return"login"},enumerable:!1,configurable:!0}),u.prototype.install=function(){return this.login.bind(this)},u.prototype.login=function(u){this.driver.runSyncHook("beforeLogin",u);var a,s=i.randomAlphaNumericString(43),c=(a=s,i.hexToBase64(d.default(a)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")),g=t.getConfig();if(!g||!g.liffId)throw i.createLiffError(e.INVALID_CONFIG,"You need to define `liffId` for liff.login()");var p={app_id:g.liffId,state:i.randomAlphaNumericString(12),response_type:"code",code_challenge_method:"S256",code_challenge:c,liff_sdk_version:n.getVersion()};u&&u.redirectUri&&(p.redirect_uri=u.redirectUri),f.isSubWindow()&&!l.isInClient()&&(p.disable_auto_login="true"),t.setLoginTmp({codeVerifier:s});var h=o.getEndPoint("authorize")+"?"+i.qs.stringify(p);r.logger.debug("[Redirect] "+h),window.location.href=h},u}();exports.LoginModule=a;
