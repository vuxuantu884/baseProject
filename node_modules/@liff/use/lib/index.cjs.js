"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("@liff/logger"),r=function(e,t){var r=this;this._driver=e,this.liff=t,this.addHooks=function(e){r._driver.addHooks(e)}},o=function(){function t(){this.modules=new Set,this.hooksSet=new Set}return t.prototype.addHooks=function(e){this.hooksSet.add(e)},t.prototype.addModule=function(e){this.modules.add(e)},t.prototype.hasModule=function(e){return this.modules.has(e)},t.prototype.runHook=function(t){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return e.__awaiter(this,void 0,void 0,(function(){var o,n,i,a,s,u,l,f;return e.__generator(this,(function(d){switch(d.label){case 0:o=[];try{for(n=e.__values(this.hooksSet),i=n.next();!i.done;i=n.next())a=i.value,"function"==typeof(s=a[t])&&(u=s.apply(void 0,e.__spread(r)),o.push(u))}catch(p){l={error:p}}finally{try{i&&!i.done&&(f=n.return)&&f.call(n)}finally{if(l)throw l.error}}return[4,Promise.all(o)];case 1:return d.sent(),[2]}}))}))},t.prototype.runSyncHook=function(t){for(var r,o,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];try{for(var a=e.__values(this.hooksSet),s=a.next();!s.done;s=a.next()){var u=s.value,l=u[t];"function"==typeof l&&l.apply(void 0,e.__spread(n))}}catch(f){r={error:f}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}},t}(),n=function(){function e(e,t,r){this.driver=e,this.context=t,this.option=r}return e.prototype.install=function(){return this.factory(this.driver,this.context)},Object.defineProperty(e.prototype,"name",{get:function(){return"use"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultOption",{get:function(){return{namespacePrefix:"$"}},enumerable:!1,configurable:!0}),e.prototype.factory=function(e,r){var o=Object.assign({},this.defaultOption,this.option).namespacePrefix;return function(n,i){if(e.hasModule(n))return this;if(!n||"function"!=typeof n.install||"string"!=typeof n.name)return t.logger.warn("To install the plugin, you need to define the `name` property and the `install` method."),this;var a=""+o+n.name,s=n.install.call(n,r,i);return this[""+a]?(t.logger.warn("There is a duplicate plugin name. `"+n.name+"` plugin namespace will be override."),this[""+a]=s):void 0!==s&&(this[""+a]=s),e.addModule(n),this}},e}();exports.ModuleContextImpl=r,exports.ModuleDriverImpl=o,exports.UseModule=n;
